<html lang="zh-CN"><head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
<title>比特币助记词生成</title>


<style type="text/css">@font-face {font-family:Inter;font-style:normal;font-weight:400;src:url(/cf-fonts/v/inter/5.0.16/greek-ext/wght/normal.woff2);unicode-range:U+1F00-1FFF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:400;src:url(/cf-fonts/v/inter/5.0.16/cyrillic-ext/wght/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:400;src:url(/cf-fonts/v/inter/5.0.16/cyrillic/wght/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:400;src:url(/cf-fonts/v/inter/5.0.16/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:400;src:url(/cf-fonts/v/inter/5.0.16/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:400;src:url(/cf-fonts/v/inter/5.0.16/vietnamese/wght/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:400;src:url(/cf-fonts/v/inter/5.0.16/greek/wght/normal.woff2);unicode-range:U+0370-03FF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:500;src:url(/cf-fonts/v/inter/5.0.16/greek-ext/wght/normal.woff2);unicode-range:U+1F00-1FFF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:500;src:url(/cf-fonts/v/inter/5.0.16/cyrillic-ext/wght/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:500;src:url(/cf-fonts/v/inter/5.0.16/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:500;src:url(/cf-fonts/v/inter/5.0.16/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:500;src:url(/cf-fonts/v/inter/5.0.16/vietnamese/wght/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:500;src:url(/cf-fonts/v/inter/5.0.16/greek/wght/normal.woff2);unicode-range:U+0370-03FF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:500;src:url(/cf-fonts/v/inter/5.0.16/cyrillic/wght/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:600;src:url(/cf-fonts/v/inter/5.0.16/greek-ext/wght/normal.woff2);unicode-range:U+1F00-1FFF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:600;src:url(/cf-fonts/v/inter/5.0.16/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:600;src:url(/cf-fonts/v/inter/5.0.16/vietnamese/wght/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:600;src:url(/cf-fonts/v/inter/5.0.16/greek/wght/normal.woff2);unicode-range:U+0370-03FF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:600;src:url(/cf-fonts/v/inter/5.0.16/cyrillic/wght/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:600;src:url(/cf-fonts/v/inter/5.0.16/cyrillic-ext/wght/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:600;src:url(/cf-fonts/v/inter/5.0.16/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:700;src:url(/cf-fonts/v/inter/5.0.16/cyrillic/wght/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:700;src:url(/cf-fonts/v/inter/5.0.16/cyrillic-ext/wght/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:700;src:url(/cf-fonts/v/inter/5.0.16/vietnamese/wght/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:700;src:url(/cf-fonts/v/inter/5.0.16/greek-ext/wght/normal.woff2);unicode-range:U+1F00-1FFF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:700;src:url(/cf-fonts/v/inter/5.0.16/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:700;src:url(/cf-fonts/v/inter/5.0.16/greek/wght/normal.woff2);unicode-range:U+0370-03FF;font-display:swap;}@font-face {font-family:Inter;font-style:normal;font-weight:700;src:url(/cf-fonts/v/inter/5.0.16/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:JetBrains Mono;font-style:normal;font-weight:400;src:url(/cf-fonts/v/jetbrains-mono/5.0.18/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:JetBrains Mono;font-style:normal;font-weight:400;src:url(/cf-fonts/v/jetbrains-mono/5.0.18/cyrillic/wght/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:JetBrains Mono;font-style:normal;font-weight:400;src:url(/cf-fonts/v/jetbrains-mono/5.0.18/greek/wght/normal.woff2);unicode-range:U+0370-03FF;font-display:swap;}@font-face {font-family:JetBrains Mono;font-style:normal;font-weight:400;src:url(/cf-fonts/v/jetbrains-mono/5.0.18/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:JetBrains Mono;font-style:normal;font-weight:400;src:url(/cf-fonts/v/jetbrains-mono/5.0.18/cyrillic-ext/wght/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}@font-face {font-family:JetBrains Mono;font-style:normal;font-weight:400;src:url(/cf-fonts/v/jetbrains-mono/5.0.18/vietnamese/wght/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:JetBrains Mono;font-style:normal;font-weight:500;src:url(/cf-fonts/v/jetbrains-mono/5.0.18/vietnamese/wght/normal.woff2);unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;font-display:swap;}@font-face {font-family:JetBrains Mono;font-style:normal;font-weight:500;src:url(/cf-fonts/v/jetbrains-mono/5.0.18/greek/wght/normal.woff2);unicode-range:U+0370-03FF;font-display:swap;}@font-face {font-family:JetBrains Mono;font-style:normal;font-weight:500;src:url(/cf-fonts/v/jetbrains-mono/5.0.18/latin/wght/normal.woff2);unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;font-display:swap;}@font-face {font-family:JetBrains Mono;font-style:normal;font-weight:500;src:url(/cf-fonts/v/jetbrains-mono/5.0.18/cyrillic/wght/normal.woff2);unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;font-display:swap;}@font-face {font-family:JetBrains Mono;font-style:normal;font-weight:500;src:url(/cf-fonts/v/jetbrains-mono/5.0.18/latin-ext/wght/normal.woff2);unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF;font-display:swap;}@font-face {font-family:JetBrains Mono;font-style:normal;font-weight:500;src:url(/cf-fonts/v/jetbrains-mono/5.0.18/cyrillic-ext/wght/normal.woff2);unicode-range:U+0460-052F,U+1C80-1C88,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;font-display:swap;}</style>
<style>
:root {
  /* 白天模式（默认） */
  --bg-primary: #F8F9FA;
  --bg-secondary: #ffffff;
  --bg-gradient-start: #F8F9FA;
  --bg-gradient-end: #E0F2F7;
  --text-primary: #000000;
  --text-secondary: #4A5568;
  --text-muted: #707275;
  --border-color: #E5E7EB;
  --border-light: #D1D5DB;
  
  --primary: #F7931A;
  --primary-gradient-start: #F7931A;
  --primary-gradient-end: #FFB84D;
  --primary-dark: #E68517;
  --primary-light: #FFE5CC;
  --primary-hover: #E68517;
  
  --secondary: #ffffff;
  --secondary-border: #D1D5DB;
  --secondary-text: #333333;
  
  --accent: #7e3af2;
  --warning: #ff5a1f;
  --warning-bg: rgba(255, 90, 31, 0.1);
  --warning-border: #ff5a1f;
  --success: #0e9f6e;
  
  --card-bg: #ffffff;
  --card-border: #E5E7EB;
  --card-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
  
  --mnemonic-bg: #f0f4f8;
  --mnemonic-word-bg: #FFE5CC;
  --mnemonic-word-text: #B85C0D;
  --mnemonic-word-border: rgba(247, 147, 26, 0.2);
  --mnemonic-word-hover-bg: #FFD9B3;
  --mnemonic-word-hover-text: #9A4A0A;
  
  --radius: 0.5rem;
  --shadow-sm: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
}

[data-theme="dark"] {
  /* 夜晚模式 */
  --bg-primary: #0a0a0a;
  --bg-secondary: #1a202c;
  --bg-gradient-start: #0a0a0a;
  --bg-gradient-end: #1e293b;
  --text-primary: #ffffff;
  --text-secondary: #e2e8f0;
  --text-muted: #cbd5e0;
  --border-color: #4a5568;
  --border-light: #718096;
  
  --primary: #F7931A;
  --primary-gradient-start: #F7931A;
  --primary-gradient-end: #FFB84D;
  --primary-dark: #E68517;
  --primary-light: #8B5A2E;
  --primary-hover: #FFB84D;
  
  --secondary: #2d3748;
  --secondary-border: #4a5568;
  --secondary-text: #e2e8f0;
  
  --accent: #9f7aea;
  --warning: #ff7a47;
  --warning-bg: rgba(255, 90, 31, 0.2);
  --warning-border: #ff5a1f;
  --success: #48bb78;
  
  --card-bg: #1a202c;
  --card-border: #4a5568;
  --card-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.3), 0 1px 2px 0 rgba(0, 0, 0, 0.2);
  
  --mnemonic-bg: #1a202c;
  --mnemonic-word-bg: #8B5A2E;
  --mnemonic-word-text: #FFE5CC;
  --mnemonic-word-border: rgba(247, 147, 26, 0.4);
  --mnemonic-word-hover-bg: #E68517;
  --mnemonic-word-hover-text: #FFE5CC;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html {
  overflow-x: hidden;
  -webkit-text-size-adjust: 100%;
  -webkit-tap-highlight-color: transparent;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background: linear-gradient(to bottom, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
  background-attachment: fixed;
  color: var(--text-primary);
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  min-height: 100vh;
  line-height: 1.6;
  transition: background 0.5s ease, color 0.3s ease;
  overflow-x: hidden;
  width: 100%;
}

/* 主题切换按钮 */
.theme-toggle {
  position: fixed;
  top: 1.5rem;
  right: 1.5rem;
  width: 48px;
  height: 48px;
  border-radius: 50%;
  /* 白天模式：按钮昏暗像月亮（默认样式） */
  background: linear-gradient(135deg, #4b5563 0%, #374151 100%);
  border: 1px solid #4b5563;
  color: #d1d5db;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.2rem;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  transition: all 0.3s ease;
  z-index: 1000;
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
}

/* 夜晚模式：按钮明亮像太阳 */
[data-theme="dark"] .theme-toggle {
  background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
  border: 1px solid #f59e0b;
  color: #ffffff;
  box-shadow: 0 4px 12px rgba(251, 191, 36, 0.4), 0 0 20px rgba(251, 191, 36, 0.2);
}

.theme-toggle:hover {
  transform: scale(1.1);
}

/* 白天模式悬停效果 */
html:not([data-theme="dark"]) .theme-toggle:hover {
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
  background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
}

/* 夜晚模式悬停效果 */
[data-theme="dark"] .theme-toggle:hover {
  box-shadow: 0 6px 16px rgba(251, 191, 36, 0.5), 0 0 24px rgba(251, 191, 36, 0.3);
  background: linear-gradient(135deg, #fcd34d 0%, #fbbf24 100%);
}

.theme-toggle svg {
  width: 24px;
  height: 24px;
  fill: none;
  stroke: currentColor;
  stroke-width: 2.5;
  stroke-linecap: round;
  stroke-linejoin: round;
  transition: all 0.3s ease;
}

/* 太阳图标在夜晚模式下的额外亮度 */
[data-theme="dark"] .theme-toggle svg {
  filter: drop-shadow(0 0 4px rgba(255, 255, 255, 0.5));
}

header {
  margin: 4rem 1rem 2rem;
  text-align: center;
  animation: fadeIn 0.8s ease-out;
  max-width: 1400px;
  width: 100%;
  box-sizing: border-box;
  padding: 0 1rem;
}

/* 桌面端 Header 优化 */
@media (min-width: 769px) {
  header {
    max-width: 1500px;
  }
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}

header h1 {
  margin: 0;
  color: var(--text-primary);
  font-weight: 800;
  font-size: 3rem;
  letter-spacing: -1px;
  line-height: 1.2;
  margin-bottom: 1rem;
}

header p {
  margin: 1rem 0;
  color: var(--text-secondary);
  font-size: 1.1rem;
  font-weight: 400;
  max-width: 700px;
  margin-left: auto;
  margin-right: auto;
}

main {
  width: 95%;
  max-width: 1200px;
  background: transparent;
  padding: 2.5rem;
  box-shadow: none;
  border: none;
  border-radius: 0;
  position: relative;
  margin: 0 auto 2rem;
  transition: transform 0.3s ease;
  animation: slideUp 0.6s ease-out;
  box-sizing: border-box;
}

/* 桌面端优化 */
@media (min-width: 769px) {
  main {
    width: 96%;
    max-width: 1400px;
  }
}

@keyframes slideUp {
  from { opacity: 0; transform: translateY(20px); }
  to { opacity: 1; transform: translateY(0); }
}

main:hover {
  transform: none;
}

.warning {
  background-color: rgba(255, 0, 0, 0.5);
  border: none;
  padding: 2rem;
  border-radius: var(--radius);
  margin-bottom: 2rem;
  position: relative;
  overflow: hidden;
  transition: all 0.3s ease;
  display: flex;
  align-items: flex-start;
  width: 100%;
  box-sizing: border-box;
  line-height: 1.6;
  text-align: left;
  box-shadow: 0 4px 12px rgba(255, 0, 0, 0.3), 0 2px 4px rgba(255, 0, 0, 0.2);
}

.warning-icon {
  margin-right: 1rem;
  font-size: 2rem;
  color: #ffffff;
  flex-shrink: 0;
}

.warning-content {
  flex: 1;
}

.warning-content strong {
  display: block;
  color: #ffffff;
  font-size: 1.5rem;
  margin-bottom: 1rem;
  font-weight: 700;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.warning-text {
  line-height: 1.7;
  color: #ffffff;
  font-size: 1.1rem;
  font-weight: 600;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
}

.warning:hover {
  background-color: rgba(230, 0, 0, 0.5);
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(255, 0, 0, 0.4), 0 4px 8px rgba(255, 0, 0, 0.3);
}

[data-theme="dark"] .warning {
  background-color: rgba(255, 0, 0, 0.5);
}

[data-theme="dark"] .warning:hover {
  background-color: rgba(230, 0, 0, 0.5);
}

.file-input {
  margin-bottom: 1.5rem;
  padding: 1.25rem;
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius);
  transition: all 0.2s ease;
  box-shadow: var(--shadow-sm);
}

.file-input:hover {
  border-color: var(--border-light);
}

label {
  display: block;
  margin-bottom: 0.75rem;
  color: var(--text-secondary);
  font-weight: 500;
  font-size: 0.95rem;
}

input[type="file"] {
  display: block;
  width: 100%;
  padding: 0.5rem;
  background: var(--card-bg);
  border: 1px solid var(--border-color);
  border-radius: 0.375rem;
  cursor: pointer;
  font-size: 0.9rem;
  color: var(--text-primary);
  transition: border-color 0.2s ease;
  min-height: 44px;
  box-sizing: border-box;
}

input[type="file"]:hover {
  border-color: var(--primary);
}

#sha256-display {
  margin-top: 0.75rem;
  padding: 0.5rem;
  font-family: 'JetBrains Mono', monospace;
  font-size: 0.8rem;
  color: var(--text-secondary);
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: 0.25rem;
  word-break: break-all;
  line-height: 1.5;
  transition: background 0.3s ease, border-color 0.3s ease, color 0.3s ease;
  box-shadow: var(--shadow-sm);
}

#sha256-display small {
  display: block;
  margin-top: 0.5rem;
  font-size: 0.75rem;
  color: var(--text-muted);
}

.options {
  margin: 1.5rem 0;
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  gap: 0.5rem;
}

.options label {
  margin-bottom: 0;
  margin-right: 0.5rem;
  color: var(--text-secondary);
}

button {
  background: linear-gradient(to right, var(--primary-gradient-start), var(--primary-gradient-end));
  color: #ffffff;
  border: none;
  padding: 0.75rem 1.5rem;
  border-radius: 0.375rem;
  cursor: pointer;
  font-size: 0.95rem;
  font-weight: 500;
  margin: 0.5rem 0;
  transition: all 0.2s ease;
  box-shadow: var(--shadow-sm);
  position: relative;
  overflow: hidden;
  min-height: 44px;
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
  box-sizing: border-box;
}

button.secondary {
  background: var(--secondary);
  color: var(--secondary-text);
  border: 1px solid var(--secondary-border);
  box-shadow: var(--shadow-sm);
}

button.secondary:hover {
  background: var(--bg-secondary);
  border-color: var(--border-light);
}

button::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(to bottom, rgba(255,255,255,0.1), rgba(255,255,255,0));
  opacity: 0;
  transition: opacity 0.2s ease;
}

button:hover::after {
  opacity: 1;
}

button:active {
  transform: translateY(1px);
}

button:disabled {
  background: var(--border-color);
  color: var(--text-muted);
  cursor: not-allowed;
  box-shadow: none;
  opacity: 0.6;
}

button:disabled:hover {
  transform: none;
}

#btn-generate {
  background: linear-gradient(to right, var(--primary-gradient-start), var(--primary-gradient-end));
  padding: 0.85rem 2rem;
  font-size: 1.05rem;
  margin: 1rem 0;
  width: 100%;
  font-weight: 600;
  letter-spacing: 0.5px;
  box-shadow: 0 4px 6px -1px rgba(247, 147, 26, 0.3), 0 2px 4px -1px rgba(247, 147, 26, 0.2);
}

.mnemonic {
  margin-top: 2rem;
  word-break: break-word;
  padding: 2rem;
  background: var(--mnemonic-bg);
  border: none;
  border-radius: var(--radius);
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  font-size: 0;
  line-height: 1.6;
  min-height: 5rem;
  transition: all 0.3s ease;
  box-shadow: none;
  display: flex;
  flex-wrap: wrap;
  gap: 1.5rem;
  align-items: center;
  box-sizing: border-box;
  width: 100%;
}

/* 桌面端：每行4个单词 */
@media (min-width: 769px) {
  #mnemonic span {
    flex: 0 0 calc(25% - 1.125rem); /* 每行4个，减去3个gap的平均值 */
    max-width: calc(25% - 1.125rem);
  }
}

/* 大屏幕上助记词显示优化 */
@media (min-width: 1025px) {
  .mnemonic {
    gap: 2rem;
    padding: 2.5rem;
  }
  
  #mnemonic span {
    flex: 0 0 calc(25% - 1.5rem); /* 每行4个，减去3个gap的平均值 */
    max-width: calc(25% - 1.5rem);
    font-size: 1.6rem;
    padding: 1.2rem 1.8rem;
  }
}

#mnemonic span {
  display: inline-block;
  padding: 1rem 1.6rem;
  margin: 0;
  background: linear-gradient(to right, rgba(247, 147, 26, 0.7), rgba(255, 184, 77, 0.7));
  border-radius: 0.6rem;
  color: #ffffff;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  font-size: 1.5rem;
  font-weight: 600;
  letter-spacing: 0.02em;
  text-transform: lowercase;
  transition: all 0.2s ease;
  box-shadow: 0 4px 6px -1px rgba(247, 147, 26, 0.3), 0 2px 4px -1px rgba(247, 147, 26, 0.2);
  border: none;
  cursor: default;
  white-space: nowrap;
  box-sizing: border-box;
  text-align: center;
}

#mnemonic span:hover {
  background: linear-gradient(to right, rgba(230, 133, 23, 0.7), rgba(230, 133, 23, 0.7));
  color: #ffffff;
  transform: translateY(-2px);
  box-shadow: 0 6px 12px -1px rgba(247, 147, 26, 0.4), 0 4px 8px -1px rgba(247, 147, 26, 0.3);
}

.mnemonic:not(:empty) {
  background: var(--mnemonic-bg);
}

.actions {
  margin-top: 1.5rem;
  display: flex;
  flex-wrap: wrap;
  gap: 0.75rem;
  justify-content: flex-start;
  width: 100%;
}

.actions button {
  width: 100%;
}

/* 大屏幕上按钮布局优化 */
@media (min-width: 1025px) {
  .actions button {
    width: 100%;
  }
}

#btn-clear {
  background: linear-gradient(to right, var(--primary-gradient-start), var(--primary-gradient-end));
  padding: 0.85rem 2rem;
  font-size: 1.05rem;
  margin: 1rem 0;
  width: 100%;
  font-weight: 600;
  letter-spacing: 0.5px;
  color: #ffffff;
  border: none;
  box-shadow: 0 4px 6px -1px rgba(247, 147, 26, 0.3), 0 2px 4px -1px rgba(247, 147, 26, 0.2);
}

footer {
  margin-top: auto;
  padding: 1.5rem;
  font-size: 0.9rem;
  color: var(--text-muted);
  text-align: center;
  width: 100%;
  background: rgba(255,255,255,0.5);
  backdrop-filter: blur(10px);
  transition: background 0.3s ease, color 0.3s ease;
  box-sizing: border-box;
  word-wrap: break-word;
  overflow-wrap: break-word;
}

footer a {
  display: inline-block;
  word-break: break-all;
  max-width: 100%;
}

[data-theme="dark"] footer {
  background: rgba(26, 32, 44, 0.8);
}

a {
  color: var(--primary);
  text-decoration: none;
  transition: color 0.2s;
}

a:hover {
  color: var(--primary-hover);
  text-decoration: underline;
}

/* 平板设备 (641px - 1024px) */
@media (max-width: 1024px) and (min-width: 641px) {
  header {
    margin: 3rem 1rem 1.5rem;
  }
  
  header h1 {
    font-size: 2.5rem;
  }
  
  header p {
    font-size: 1.05rem;
  }
  
  main {
    padding: 2rem;
    width: 94%;
    max-width: 1200px;
  }
  
  .mnemonic {
    padding: 1.5rem;
    gap: 1.2rem;
  }
  
  #mnemonic span {
    font-size: 1.4rem;
    padding: 0.9rem 1.5rem;
    flex: 0 0 calc(25% - 0.9rem);
    max-width: calc(25% - 0.9rem);
  }
}

/* 中等屏幕 (1025px - 1439px) */
@media (min-width: 1025px) and (max-width: 1439px) {
  main {
    width: 96%;
    max-width: 1400px;
    padding: 2.75rem;
  }
  
  header h1 {
    font-size: 3.2rem;
  }
  
  header {
    max-width: 1400px;
  }
}

/* 移动设备 (最大 640px) */
@media (max-width: 640px) {
  header {
    margin: 2.5rem 1rem 1rem;
    padding: 0 0.5rem;
  }
  
  header h1 {
    font-size: 1.75rem;
    letter-spacing: -0.5px;
    line-height: 1.3;
    margin-bottom: 0.75rem;
  }
  
  header p {
    font-size: 0.95rem;
    padding: 0 0.5rem;
  }
  
  main {
    width: 95%;
    padding: 1.25rem;
    margin-bottom: 1.5rem;
  }
  
  main:hover {
    transform: none;
  }
  
  .warning {
    padding: 1.5rem;
    margin-bottom: 1.5rem;
  }
  
  .warning-icon {
    font-size: 1.5rem;
    margin-right: 0.75rem;
    flex-shrink: 0;
  }
  
  .warning-content strong {
    font-size: 1.3rem;
    margin-bottom: 0.75rem;
  }
  
  .warning-text {
    font-size: 1rem;
    line-height: 1.5;
  }
  
  .file-input {
    padding: 1rem;
    margin-bottom: 1.25rem;
  }
  
  label {
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
  }
  
  input[type="file"] {
    font-size: 0.85rem;
    padding: 0.5rem;
  }
  
  #sha256-display {
    font-size: 0.75rem;
    padding: 0.75rem;
    line-height: 1.4;
  }
  
  #sha256-display small {
    font-size: 0.7rem;
    margin-top: 0.5rem;
  }
  
  .options {
    margin: 1.25rem 0;
    flex-direction: column;
    align-items: flex-start;
    gap: 0.75rem;
  }
  
  .options label {
    margin-bottom: 0.5rem;
    margin-right: 0;
    width: 100%;
  }
  
  .options button {
    width: 100%;
    margin: 0;
    padding: 0.75rem 1.25rem;
  }
  
  button {
    padding: 0.75rem 1.25rem;
    font-size: 0.9rem;
    margin: 0.5rem 0;
  }
  
  #btn-generate {
    padding: 0.9rem 1.5rem;
    font-size: 1rem;
    margin: 1rem 0;
  }
  
  #btn-clear {
    padding: 0.9rem 1.5rem;
    font-size: 1rem;
    margin: 1rem 0;
  }
  
  .mnemonic {
    padding: 1.5rem;
    gap: 1rem;
    margin-top: 1.5rem;
    min-height: 4rem;
  }
  
  #mnemonic span {
    padding: 0.8rem 1.3rem;
    font-size: 1.25rem;
    flex: 0 0 calc(50% - 0.5rem); /* 移动端每行2个 */
    max-width: calc(50% - 0.5rem);
  }
  
  .actions {
    flex-direction: column;
    gap: 0.75rem;
    margin-top: 1.25rem;
  }
  
  .actions button {
    width: 100%;
    margin: 0;
    padding: 0.75rem 1.5rem;
  }
  
  .theme-toggle {
    top: 0.75rem;
    right: 0.75rem;
    width: 40px;
    height: 40px;
  }
  
  .theme-toggle svg {
    width: 18px;
    height: 18px;
  }
  
  footer {
    padding: 1rem;
    font-size: 0.85rem;
  }
}

/* 小屏手机 (最大 480px) */
@media (max-width: 480px) {
  header {
    margin: 2rem 0.75rem 0.75rem;
  }
  
  header h1 {
    font-size: 1.5rem;
  }
  
  header p {
    font-size: 0.9rem;
  }
  
  main {
    width: 98%;
    padding: 1rem;
  }
  
  .warning {
    padding: 1.25rem;
    flex-direction: column;
  }
  
  .warning-icon {
    margin-bottom: 0.75rem;
    margin-right: 0;
    font-size: 1.3rem;
  }
  
  .warning-content strong {
    font-size: 1.2rem;
    margin-bottom: 0.75rem;
  }
  
  .warning-text {
    font-size: 0.95rem;
    line-height: 1.5;
  }
  
  #mnemonic span {
    padding: 0.75rem 1.2rem;
    font-size: 1.15rem;
    flex: 0 0 calc(50% - 0.4rem); /* 小屏手机每行2个 */
    max-width: calc(50% - 0.4rem);
  }
  
  .theme-toggle {
    top: 0.5rem;
    right: 0.5rem;
    width: 36px;
    height: 36px;
  }
  
  .theme-toggle svg {
    width: 16px;
    height: 16px;
  }
  
  footer {
    padding: 0.875rem;
    font-size: 0.8rem;
    line-height: 1.5;
  }
  
  footer br {
    display: block;
    margin: 0.25rem 0;
  }
}

/* 大屏设备 (最小 1440px) */
@media (min-width: 1440px) {
  main {
    width: 96%;
    max-width: 1500px;
    padding: 3rem;
  }
  
  header {
    max-width: 1500px;
  }
  
  header h1 {
    font-size: 3.5rem;
  }
  
  header p {
    font-size: 1.2rem;
    max-width: 1000px;
  }
  
  .mnemonic {
    padding: 3rem;
    gap: 2.5rem;
  }
  
  #mnemonic span {
    font-size: 1.8rem;
    padding: 1.4rem 2rem;
    flex: 0 0 calc(25% - 1.875rem); /* 每行4个，减去3个gap的平均值 */
    max-width: calc(25% - 1.875rem);
  }
}
</style>
<style data-id="immersive-translate-input-injected-css">.immersive-translate-input {
  position: absolute;
  top: 0;
  right: 0;
  left: 0;
  bottom: 0;
  z-index: 2147483647;
  display: flex;
  justify-content: center;
  align-items: center;
}
.immersive-translate-attach-loading::after {
  content: " ";

  --loading-color: #f78fb6;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  display: block;
  margin: 12px auto;
  position: relative;
  color: white;
  left: -100px;
  box-sizing: border-box;
  animation: immersiveTranslateShadowRolling 1.5s linear infinite;

  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-2000%, -50%);
  z-index: 100;
}

.immersive-translate-loading-spinner {
  vertical-align: middle !important;
  width: 10px !important;
  height: 10px !important;
  display: inline-block !important;
  margin: 0 4px !important;
  border: 2px rgba(221, 244, 255, 0.6) solid !important;
  border-top: 2px rgba(0, 0, 0, 0.375) solid !important;
  border-left: 2px rgba(0, 0, 0, 0.375) solid !important;
  border-radius: 50% !important;
  padding: 0 !important;
  -webkit-animation: immersive-translate-loading-animation 0.6s infinite linear !important;
  animation: immersive-translate-loading-animation 0.6s infinite linear !important;
}

@-webkit-keyframes immersive-translate-loading-animation {
  from {
    -webkit-transform: rotate(0deg);
  }

  to {
    -webkit-transform: rotate(359deg);
  }
}

@keyframes immersive-translate-loading-animation {
  from {
    transform: rotate(0deg);
  }

  to {
    transform: rotate(359deg);
  }
}

.immersive-translate-input-loading {
  --loading-color: #f78fb6;
  width: 6px;
  height: 6px;
  border-radius: 50%;
  display: block;
  margin: 12px auto;
  position: relative;
  color: white;
  left: -100px;
  box-sizing: border-box;
  animation: immersiveTranslateShadowRolling 1.5s linear infinite;
}

@keyframes immersiveTranslateShadowRolling {
  0% {
    box-shadow: 0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0),
      0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
  }

  12% {
    box-shadow: 100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0),
      0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
  }

  25% {
    box-shadow: 110px 0 var(--loading-color), 100px 0 var(--loading-color),
      0px 0 rgba(255, 255, 255, 0), 0px 0 rgba(255, 255, 255, 0);
  }

  36% {
    box-shadow: 120px 0 var(--loading-color), 110px 0 var(--loading-color),
      100px 0 var(--loading-color), 0px 0 rgba(255, 255, 255, 0);
  }

  50% {
    box-shadow: 130px 0 var(--loading-color), 120px 0 var(--loading-color),
      110px 0 var(--loading-color), 100px 0 var(--loading-color);
  }

  62% {
    box-shadow: 200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color),
      120px 0 var(--loading-color), 110px 0 var(--loading-color);
  }

  75% {
    box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
      130px 0 var(--loading-color), 120px 0 var(--loading-color);
  }

  87% {
    box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
      200px 0 rgba(255, 255, 255, 0), 130px 0 var(--loading-color);
  }

  100% {
    box-shadow: 200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0),
      200px 0 rgba(255, 255, 255, 0), 200px 0 rgba(255, 255, 255, 0);
  }
}

.immersive-translate-toast {
  display: flex;
  position: fixed;
  z-index: 2147483647;
  left: 0;
  right: 0;
  top: 1%;
  width: fit-content;
  padding: 12px 20px;
  margin: auto;
  overflow: auto;
  background: #fef6f9;
  box-shadow: 0px 4px 10px 0px rgba(0, 10, 30, 0.06);
  font-size: 15px;
  border-radius: 8px;
  color: #333;
}

.immersive-translate-toast-content {
  display: flex;
  flex-direction: row;
  align-items: center;
}

.immersive-translate-toast-hidden {
  margin: 0 20px 0 72px;
  text-decoration: underline;
  cursor: pointer;
}

.immersive-translate-toast-close {
  color: #666666;
  font-size: 20px;
  font-weight: bold;
  padding: 0 10px;
  cursor: pointer;
}

@media screen and (max-width: 768px) {
  .immersive-translate-toast {
    top: 0;
    padding: 12px 0px 0 10px;
  }
  .immersive-translate-toast-content {
    flex-direction: column;
    text-align: center;
  }
  .immersive-translate-toast-hidden {
    margin: 10px auto;
  }
}

.immersive-translate-dialog {
  position: fixed;
  z-index: 2147483647;
  left: 0;
  top: 0;
  display: flex;
  width: 300px;
  flex-direction: column;
  align-items: center;
  font-size: 15px;
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;
  margin: auto;
  height: fit-content;
  border-radius: 20px;
  background-color: #fff;
}

.immersive-translate-modal {
  display: none;
  position: fixed;
  z-index: 2147483647;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgb(0, 0, 0);
  background-color: rgba(0, 0, 0, 0.4);
  font-size: 15px;
}

.immersive-translate-modal-content {
  background-color: #fefefe;
  margin: 10% auto;
  padding: 40px 24px 24px;
  border-radius: 12px;
  width: 350px;
  font-family: system-ui, -apple-system, "Segoe UI", "Roboto", "Ubuntu",
    "Cantarell", "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji",
    "Segoe UI Symbol", "Noto Color Emoji";
  position: relative;
}

@media screen and (max-width: 768px) {
  .immersive-translate-modal-content {
    margin: 25% auto !important;
  }
}

@media screen and (max-width: 480px) {
  .immersive-translate-modal-content {
    width: 80vw !important;
    margin: 20vh auto !important;
    padding: 20px 12px 12px !important;
  }

  .immersive-translate-modal-title {
    font-size: 14px !important;
  }

  .immersive-translate-modal-body {
    font-size: 13px !important;
    max-height: 60vh !important;
  }

  .immersive-translate-btn {
    font-size: 13px !important;
    padding: 8px 16px !important;
    margin: 0 4px !important;
  }

  .immersive-translate-modal-footer {
    gap: 6px !important;
    margin-top: 16px !important;
  }
}

.immersive-translate-modal .immersive-translate-modal-content-in-input {
  max-width: 500px;
}
.immersive-translate-modal-content-in-input .immersive-translate-modal-body {
  text-align: left;
  max-height: unset;
}

.immersive-translate-modal-title {
  text-align: center;
  font-size: 16px;
  font-weight: 700;
  color: #333333;
}

.immersive-translate-modal-body {
  text-align: center;
  font-size: 14px;
  font-weight: 400;
  color: #333333;
  margin-top: 24px;
  word-break: break-all;
}

@media screen and (max-width: 768px) {
  .immersive-translate-modal-body {
    max-height: 250px;
    overflow-y: auto;
  }
}

.immersive-translate-close {
  color: #666666;
  position: absolute;
  right: 16px;
  top: 16px;
  font-size: 20px;
  font-weight: bold;
}

.immersive-translate-close:hover,
.immersive-translate-close:focus {
  text-decoration: none;
  cursor: pointer;
}

.immersive-translate-modal-footer {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  margin-top: 24px;
}

.immersive-translate-btn {
  width: fit-content;
  color: #fff;
  background-color: #ea4c89;
  border: none;
  font-size: 14px;
  margin: 0 8px;
  padding: 9px 30px;
  border-radius: 5px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.immersive-translate-btn-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.immersive-translate-btn:hover {
  background-color: #f082ac;
}
.immersive-translate-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
.immersive-translate-btn:disabled:hover {
  background-color: #ea4c89;
}

.immersive-translate-link-btn {
  background-color: transparent;
  color: #ea4c89;
  border: none;
  cursor: pointer;
  height: 30px;
  line-height: 30px;
}

.immersive-translate-cancel-btn {
  /* gray color */
  background-color: rgb(89, 107, 120);
}

.immersive-translate-cancel-btn:hover {
  background-color: hsl(205, 20%, 32%);
}

.immersive-translate-action-btn {
  background-color: transparent;
  color: #ea4c89;
  border: 1px solid #ea4c89;
}

.immersive-translate-btn svg {
  margin-right: 5px;
}

.immersive-translate-link {
  cursor: pointer;
  user-select: none;
  -webkit-user-drag: none;
  text-decoration: none;
  color: #ea4c89;
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
}

.immersive-translate-primary-link {
  cursor: pointer;
  user-select: none;
  -webkit-user-drag: none;
  text-decoration: none;
  color: #ea4c89;
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0.1);
}

.immersive-translate-modal input[type="radio"] {
  margin: 0 6px;
  cursor: pointer;
}

.immersive-translate-modal label {
  cursor: pointer;
}

.immersive-translate-close-action {
  position: absolute;
  top: 2px;
  right: 0px;
  cursor: pointer;
}

.imt-image-status {
  background-color: rgba(0, 0, 0, 0.5) !important;
  display: flex !important;
  flex-direction: column !important;
  align-items: center !important;
  justify-content: center !important;
  border-radius: 16px !important;
}
.imt-image-status img,
.imt-image-status svg,
.imt-img-loading {
  width: 28px !important;
  height: 28px !important;
  margin: 0 0 8px 0 !important;
  min-height: 28px !important;
  min-width: 28px !important;
  position: relative !important;
}
.imt-img-loading {
  background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAA4CAMAAACfWMssAAAAtFBMVEUAAAD////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////oK74hAAAAPHRSTlMABBMIDyQXHwyBfFdDMSw+OjXCb+5RG51IvV/k0rOqlGRM6KKMhdvNyZBz9MaupmxpWyj437iYd/yJVNZeuUC7AAACt0lEQVRIx53T2XKiUBCA4QYOiyCbiAsuuGBcYtxiYtT3f6/pbqoYHVFO5r+iivpo6DpAWYpqeoFfr9f90DsYAuRSWkFnPO50OgR9PwiCUFcl2GEcx+N/YBh6pvKaefHlUgZd1zVe0NbYcQjGBfzrPE8Xz8aF+71D8gG6DHFPpc4a7xFiCDuhaWgKgGIJQ3d5IMGDrpS4S5KgpIm+en9f6PlAhKby4JwEIxlYJV9h5k5nee9GoxHJ2IDSNB0dwdad1NAxDJ/uXDHYmebdk4PdbkS58CIVHdYSUHTYYRWOJblWSyu2lmy3KNFVJNBhxcuGW4YBVCbYGRZwIooipHsNqjM4FbgOQqQqSKQQU9V8xmi1QlgHqQQ6DDBvRUVCDirs+EzGDGOQTCATgtYTnbCVLgsVgRE0T1QE0qHCFAht2z6dLvJQs3Lo2FQoDxWNUiBhaP4eRgwNkI+dAjVOA/kUrIDwf3CG8NfNOE0eiFotSuo+rBiq8tD9oY4Qzc6YJw99hl1wzpQvD7ef2M8QgnOGJfJw+EltQc+oX2yn907QB22WZcvlUpd143dqQu+8pCJZuGE4xCuPXJqqcs5sNpsI93Rmzym1k4Npk+oD1SH3/a3LOK/JpUBpWfqNySxWzCfNCUITuDG5dtuphrUJ1myeIE9bIsPiKrfqTai5WZxbhtNphYx6GEIHihyGFTI69lje/rxajdh0s0msZ0zYxyPLhYCb1CyHm9Qsd2H37Y3lugVwL9kNh8Ot8cha6fUNQ8nuXi5z9/ExsAO4zQrb/ev1yrCB7lGyQzgYDGuxq1toDN/JGvN+HyWNHKB7zEoK+PX11e12G431erGYzwmytAWU56fkMHY5JJnDRR2eZji3AwtIcrEV8Cojat/BdQ7XOwGV1e1hDjGGjXbdArm8uJZtCH5MbcctVX8A1WpqumJHwckAAAAASUVORK5CYII=");
  background-size: 28px 28px;
  animation: image-loading-rotate 1s linear infinite !important;
}

.imt-image-status span {
  color: var(--bg-2, #fff) !important;
  font-size: 14px !important;
  line-height: 14px !important;
  font-weight: 500 !important;
  font-family: "PingFang SC", Arial, sans-serif !important;
}

.imt-primary-button {
  display: flex;
  padding: 12px 80px;
  justify-content: center;
  align-items: center;
  gap: 8px;
  border-radius: 8px;
  background: #ea4c89;
  color: #fff;
  font-size: 16px;
  font-style: normal;
  font-weight: 700;
  line-height: 24px;
  border: none;
  cursor: pointer;
}

.imt-retry-text {
  color: #999;
  text-align: center;
  font-size: 14px;
  font-style: normal;
  font-weight: 400;
  line-height: 21px;
  cursor: pointer;
}

.imt-action-container {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.imt-modal-content-text {
  text-align: left;
  color: #333;
  font-size: 16px;
  font-weight: 400;
  line-height: 24px;
}

@keyframes image-loading-rotate {
  from {
    transform: rotate(360deg);
  }
  to {
    transform: rotate(0deg);
  }
}

.imt-linear-gradient-text {
  background: linear-gradient(90deg, #00a6ff 0%, #c369ff 52.4%, #ff4590 100%);
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}

.imt-flex-center {
  display: flex;
  align-items: center;
  justify-content: center;
}

.imt-linear-black-btn {
  border-radius: 50px;
  background: linear-gradient(66deg, #222 19%, #696969 94.25%);
  height: 48px;
  width: 100%;
  color: #fff;
  font-size: 16px;
  font-weight: 700;
  display: flex;
  align-items: center;
  cursor: pointer;
  justify-content: center;
}
</style></head>
<body>
<!-- 主题切换按钮 -->
<button class="theme-toggle" id="theme-toggle" aria-label="切换主题">
  <svg id="sun-icon" style="display: none;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="12" cy="12" r="5"></circle>
    <line x1="12" y1="1" x2="12" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="23"></line>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
    <line x1="1" y1="12" x2="3" y2="12"></line>
    <line x1="21" y1="12" x2="23" y2="12"></line>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
  </svg>
  <svg id="moon-icon" style="display: block;" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
  </svg>
</button>

<header>
<h1>比特币助记词生成</h1>
<p>完全离线 · 强烈建议断网使用 · 开源可信</p>
</header>
<main>
<div class="warning">
  <div class="warning-icon">⚠️</div>
  <div class="warning-content">
    <strong>安全提示</strong>
    <div class="warning-text">请在离线环境中使用本页面。内置 BIP39 标准英文词表（2048 词），显示 SHA256 校验值。如存在 english.txt 文件会自动加载（覆盖内置词表），也可手动上传文件覆盖。</div>
  </div>
</div>

<div class="file-input">
<label for="wordlist">上传 BIP39 英文词表 (english.txt) - 可选，覆盖内置词表：</label>
<input type="file" id="wordlist" accept=".txt">
<div id="sha256-display">SHA256: 187db04a869dd9bc7be80d21a86497d692c0db6abd3aa8cb6be5d618ff757fae (默认加载)</div>
</div>

<div class="options">
<label>助记词长度：</label>
<button id="btn-12">12 词</button>
<button id="btn-24">24 词</button>
</div>

<button id="btn-generate">生成助记词</button>
<div class="mnemonic" id="mnemonic"></div>

<div class="actions">
<button id="btn-clear">清除</button>
</div>

<div class="address-section" id="address-section" style="display: none;">
  <div class="address-label">比特币收款地址：</div>
  <div class="address-container">
    <input type="text" id="btc-address" class="address-input" readonly placeholder="生成助记词后自动计算地址">
    <button id="btn-copy-address" class="btn-copy-address">复制</button>
  </div>
</div>
</main>

<footer>
源码开源 · 请自行验证本项目 <br>
部署 &amp; 安全由你掌控 · 强烈建议保存助记词后断网关闭本页面 <br>
原始出处：<a href="https://bip39.btchao.com/" target="_blank" rel="noopener noreferrer">https://bip39.btchao.com/</a>
</footer>

<style>
/* 添加动画和交互效果 */
.ripple {
  position: absolute;
  background: rgba(255, 255, 255, 0.3);
  border-radius: 50%;
  transform: scale(0);
  animation: ripple 0.6s linear;
  pointer-events: none;
}

@keyframes ripple {
  to {
    transform: scale(4);
    opacity: 0;
  }
}

button {
  position: relative;
  overflow: hidden;
}

.loading {
  position: relative;
  pointer-events: none;
}

.loading::after {
  content: '';
  position: absolute;
  width: 20px;
  height: 20px;
  top: 50%;
  right: 10px;
  margin-top: -10px;
  border: 2px solid rgba(255,255,255,0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

@keyframes spin {
  to {transform: rotate(360deg);}
}

.mnemonic.generating {
  position: relative;
}

.mnemonic.generating::after {
  content: '';
  position: absolute;
  width: 30px;
  height: 30px;
  top: 50%;
  left: 50%;
  margin-top: -15px;
  margin-left: -15px;
  border: 3px solid rgba(247, 147, 26, 0.2);
  border-top-color: var(--primary);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

.mnemonic.cleared {
  animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
}

@keyframes shake {
  10%, 90% {transform: translate3d(-1px, 0, 0);}
  20%, 80% {transform: translate3d(2px, 0, 0);}
  30%, 50%, 70% {transform: translate3d(-4px, 0, 0);}
  40%, 60% {transform: translate3d(4px, 0, 0);}
}

body.loaded main,
body.loaded header {
  opacity: 1;
  transform: translateY(0);
}

#sha256-display {
  transition: color 0.3s ease;
}

.file-input:focus-within {
  box-shadow: 0 0 0 3px rgba(247, 147, 26, 0.5);
}

input[type="file"]:focus {
  outline: none;
  border-color: var(--primary);
}

/* 助记词显示区域增强 */
.mnemonic:not(:empty) {
  background: var(--mnemonic-bg);
}

/* 按钮悬停效果增强 */
button:hover:not(:disabled):not(.theme-toggle) {
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

/* 地址显示区域 */
.address-section {
  margin-top: 2rem;
  padding: 1.5rem;
  background: var(--card-bg);
  border: 1px solid var(--card-border);
  border-radius: var(--radius);
  box-shadow: var(--card-shadow);
}

.address-label {
  font-size: 0.95rem;
  font-weight: 600;
  color: var(--text-secondary);
  margin-bottom: 0.75rem;
}

.address-container {
  display: flex;
  gap: 0.75rem;
  align-items: center;
}

.address-input {
  flex: 1;
  padding: 0.75rem 1rem;
  font-size: 0.9rem;
  font-family: 'JetBrains Mono', monospace;
  background: var(--bg-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--radius);
  color: var(--text-primary);
  outline: none;
  transition: all 0.2s ease;
  word-break: break-all;
}

.address-input:focus {
  border-color: var(--primary);
  box-shadow: 0 0 0 3px rgba(247, 147, 26, 0.1);
}

.btn-copy-address {
  flex-shrink: 0;
  padding: 0.75rem 1.5rem;
  min-width: 80px;
  font-size: 0.9rem;
}

@media (max-width: 640px) {
  .address-container {
    flex-direction: column;
  }
  
  .address-input,
  .btn-copy-address {
    width: 100%;
  }
}
</style>

<script type="text/javascript">
(async()=>{
// 主题切换功能
const themeToggle = document.getElementById("theme-toggle");
const sunIcon = document.getElementById("sun-icon");
const moonIcon = document.getElementById("moon-icon");
const htmlElement = document.documentElement;

// 从localStorage读取保存的主题，或使用系统偏好
function getInitialTheme() {
  const savedTheme = localStorage.getItem('theme');
  if (savedTheme) {
    return savedTheme;
  }
  // 检测系统偏好
  if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    return 'dark';
  }
  return 'light';
}

// 应用主题
function setTheme(theme) {
  if (theme === 'dark') {
    htmlElement.setAttribute('data-theme', 'dark');
    // 夜晚模式：显示明亮的太阳图标（表示切换到白天）
    sunIcon.style.display = 'block';
    moonIcon.style.display = 'none';
    localStorage.setItem('theme', 'dark');
  } else {
    htmlElement.removeAttribute('data-theme');
    // 白天模式：显示昏暗的月亮图标（表示切换到夜晚）
    sunIcon.style.display = 'none';
    moonIcon.style.display = 'block';
    localStorage.setItem('theme', 'light');
  }
}

// 初始化主题
setTheme(getInitialTheme());

// 主题切换按钮点击事件
themeToggle.addEventListener('click', () => {
  const currentTheme = htmlElement.getAttribute('data-theme');
  setTheme(currentTheme === 'dark' ? 'light' : 'dark');
});

// 监听系统主题变化
if (window.matchMedia) {
  window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
    // 如果用户没有手动设置过主题，则跟随系统
    if (!localStorage.getItem('theme')) {
      setTheme(e.matches ? 'dark' : 'light');
    }
  });
}

const shaDisplay=document.getElementById("sha256-display");
const btnGenerate=document.getElementById("btn-generate");
const mnemonicDiv=document.getElementById("mnemonic");
const btnClear=document.getElementById("btn-clear");
const btn12=document.getElementById("btn-12");
const btn24=document.getElementById("btn-24");
const addressSection=document.getElementById("address-section");
const btcAddressInput=document.getElementById("btc-address");
const btnCopyAddress=document.getElementById("btn-copy-address");
let wordCount=12;
btn12.disabled=true;
let currentMnemonic=""; // 存储当前助记词

// 添加按钮点击波纹效果
const addRippleEffect = (button) => {
  button.addEventListener('click', function(e) {
    if (this.disabled) return;
    
    const ripple = document.createElement('span');
    ripple.classList.add('ripple');
    this.appendChild(ripple);
    
    const rect = this.getBoundingClientRect();
    const size = Math.max(rect.width, rect.height);
    
    ripple.style.width = ripple.style.height = `${size}px`;
    ripple.style.left = `${e.clientX - rect.left - size/2}px`;
    ripple.style.top = `${e.clientY - rect.top - size/2}px`;
    
    ripple.classList.add('active');
    
    setTimeout(() => {
      ripple.remove();
    }, 600);
  });
};

// 为所有按钮添加波纹效果
document.querySelectorAll('button').forEach(addRippleEffect);

// 添加加载动画
function showLoading(element) {
  element.classList.add('loading');
  element.setAttribute('data-text', element.textContent);
  element.textContent = '处理中...';
}

function hideLoading(element) {
  if (element.classList.contains('loading')) {
    element.textContent = element.getAttribute('data-text');
    element.classList.remove('loading');
  }
}

btn12.addEventListener("click",()=>{
  wordCount=12; 
  btn12.disabled=true; 
  btn24.disabled=false;
});

btn24.addEventListener("click",()=>{
  wordCount=24; 
  btn12.disabled=false; 
  btn24.disabled=true;
});

// 嵌入的 BIP39 标准英文词表（2048 个单词）
const EMBEDDED_BIP39_WORDLIST = ['abandon','ability','able','about','above','absent','absorb','abstract','absurd','abuse','access','accident','account','accuse','achieve','acid','acoustic','acquire','across','act','action','actor','actress','actual','adapt','add','addict','address','adjust','admit','adult','advance','advice','aerobic','affair','afford','afraid','again','age','agent','agree','ahead','aim','air','airport','aisle','alarm','album','alcohol','alert','alien','all','alley','allow','almost','alone','alpha','already','also','alter','always','amateur','amazing','among','amount','amused','analyst','anchor','ancient','anger','angle','angry','animal','ankle','announce','annual','another','answer','antenna','antique','anxiety','any','apart','apology','appear','apple','approve','april','arch','arctic','area','arena','argue','arm','armed','armor','army','around','arrange','arrest','arrive','arrow','art','artefact','artist','artwork','ask','aspect','assault','asset','assist','assume','asthma','athlete','atom','attack','attend','attitude','attract','auction','audit','august','aunt','author','auto','autumn','average','avocado','avoid','awake','aware','away','awesome','awful','awkward','axis','baby','bachelor','bacon','badge','bag','balance','balcony','ball','bamboo','banana','banner','bar','barely','bargain','barrel','base','basic','basket','battle','beach','bean','beauty','because','become','beef','before','begin','behave','behind','believe','below','belt','bench','benefit','best','betray','better','between','beyond','bicycle','bid','bike','bind','biology','bird','birth','bitter','black','blade','blame','blanket','blast','bleak','bless','blind','blood','blossom','blouse','blue','blur','blush','board','boat','body','boil','bomb','bone','bonus','book','boost','border','boring','borrow','boss','bottom','bounce','box','boy','bracket','brain','brand','brass','brave','bread','breeze','brick','bridge','brief','bright','bring','brisk','broccoli','broken','bronze','broom','brother','brown','brush','bubble','buddy','budget','buffalo','build','bulb','bulk','bullet','bundle','bunker','burden','burger','burst','bus','business','busy','butter','buyer','buzz','cabbage','cabin','cable','cactus','cage','cake','call','calm','camera','camp','can','canal','cancel','candy','cannon','canoe','canvas','canyon','capable','capital','captain','car','carbon','card','cargo','carpet','carry','cart','case','cash','casino','castle','casual','cat','catalog','catch','category','cattle','caught','cause','caution','cave','ceiling','celery','cement','census','century','cereal','certain','chair','chalk','champion','change','chaos','chapter','charge','chase','chat','cheap','check','cheese','chef','cherry','chest','chicken','chief','child','chimney','choice','choose','chronic','chuckle','chunk','churn','cigar','cinnamon','circle','citizen','city','civil','claim','clap','clarify','claw','clay','clean','clerk','clever','click','client','cliff','climb','clinic','clip','clock','clog','close','cloth','cloud','clown','club','clump','cluster','clutch','coach','coast','coconut','code','coffee','coil','coin','collect','color','column','combine','come','comfort','comic','common','company','concert','conduct','confirm','congress','connect','consider','control','convince','cook','cool','copper','copy','coral','core','corn','correct','cost','cotton','couch','country','couple','course','cousin','cover','coyote','crack','cradle','craft','cram','crane','crash','crater','crawl','crazy','cream','credit','creek','crew','cricket','crime','crisp','critic','crop','cross','crouch','crowd','crucial','cruel','cruise','crumble','crunch','crush','cry','crystal','cube','culture','cup','cupboard','curious','current','curtain','curve','cushion','custom','cute','cycle','dad','damage','damp','dance','danger','daring','dash','daughter','dawn','day','deal','debate','debris','decade','december','decide','decline','decorate','decrease','deer','defense','define','defy','degree','delay','deliver','demand','demise','denial','dentist','deny','depart','depend','deposit','depth','deputy','derive','describe','desert','design','desk','despair','destroy','detail','detect','develop','device','devote','diagram','dial','diamond','diary','dice','diesel','diet','differ','digital','dignity','dilemma','dinner','dinosaur','direct','dirt','disagree','discover','disease','dish','dismiss','disorder','display','distance','divert','divide','divorce','dizzy','doctor','document','dog','doll','dolphin','domain','donate','donkey','donor','door','dose','double','dove','draft','dragon','drama','drastic','draw','dream','dress','drift','drill','drink','drip','drive','drop','drum','dry','duck','dumb','dune','during','dust','dutch','duty','dwarf','dynamic','eager','eagle','early','earn','earth','easily','east','easy','echo','ecology','economy','edge','edit','educate','effort','egg','eight','either','elbow','elder','electric','elegant','element','elephant','elevator','elite','else','embark','embody','embrace','emerge','emotion','employ','empower','empty','enable','enact','end','endless','endorse','enemy','energy','enforce','engage','engine','enhance','enjoy','enlist','enough','enrich','enroll','ensure','enter','entire','entry','envelope','episode','equal','equip','era','erase','erode','erosion','error','erupt','escape','essay','essence','estate','eternal','ethics','evidence','evil','evoke','evolve','exact','example','excess','exchange','excite','exclude','excuse','execute','exercise','exhaust','exhibit','exile','exist','exit','exotic','expand','expect','expire','explain','expose','express','extend','extra','eye','eyebrow','fabric','face','faculty','fade','faint','faith','fall','false','fame','family','famous','fan','fancy','fantasy','farm','fashion','fat','fatal','father','fatigue','fault','favorite','feature','february','federal','fee','feed','feel','female','fence','festival','fetch','fever','few','fiber','fiction','field','figure','file','film','filter','final','find','fine','finger','finish','fire','firm','first','fiscal','fish','fit','fitness','fix','flag','flame','flash','flat','flavor','flee','flight','flip','float','flock','floor','flower','fluid','flush','fly','foam','focus','fog','foil','fold','follow','food','foot','force','forest','forget','fork','fortune','forum','forward','fossil','foster','found','fox','fragile','frame','frequent','fresh','friend','fringe','frog','front','frost','frown','frozen','fruit','fuel','fun','funny','furnace','fury','future','gadget','gain','galaxy','gallery','game','gap','garage','garbage','garden','garlic','garment','gas','gasp','gate','gather','gauge','gaze','general','genius','genre','gentle','genuine','gesture','ghost','giant','gift','giggle','ginger','giraffe','girl','give','glad','glance','glare','glass','glide','glimpse','globe','gloom','glory','glove','glow','glue','goat','goddess','gold','good','goose','gorilla','gospel','gossip','govern','gown','grab','grace','grain','grant','grape','grass','gravity','great','green','grid','grief','grit','grocery','group','grow','grunt','guard','guess','guide','guilt','guitar','gun','gym','habit','hair','half','hammer','hamster','hand','happy','harbor','hard','harsh','harvest','hat','have','hawk','hazard','head','health','heart','heavy','hedgehog','height','hello','helmet','help','hen','hero','hidden','high','hill','hint','hip','hire','history','hobby','hockey','hold','hole','holiday','hollow','home','honey','hood','hope','horn','horror','horse','hospital','host','hotel','hour','hover','hub','huge','human','humble','humor','hundred','hungry','hunt','hurdle','hurry','hurt','husband','hybrid','ice','icon','idea','identify','idle','ignore','ill','illegal','illness','image','imitate','immense','immune','impact','impose','improve','impulse','inch','include','income','increase','index','indicate','indoor','industry','infant','inflict','inform','inhale','inherit','initial','inject','injury','inmate','inner','innocent','input','inquiry','insane','insect','inside','inspire','install','intact','interest','into','invest','invite','involve','iron','island','isolate','issue','item','ivory','jacket','jaguar','jar','jazz','jealous','jeans','jelly','jewel','job','join','joke','journey','joy','judge','juice','jump','jungle','junior','junk','just','kangaroo','keen','keep','ketchup','key','kick','kid','kidney','kind','kingdom','kiss','kit','kitchen','kite','kitten','kiwi','knee','knife','knock','know','lab','label','labor','ladder','lady','lake','lamp','language','laptop','large','later','latin','laugh','laundry','lava','law','lawn','lawsuit','layer','lazy','leader','leaf','learn','leave','lecture','left','leg','legal','legend','leisure','lemon','lend','length','lens','leopard','lesson','letter','level','liar','liberty','library','license','life','lift','light','like','limb','limit','link','lion','liquid','list','little','live','lizard','load','loan','lobster','local','lock','logic','lonely','long','loop','lottery','loud','lounge','love','loyal','lucky','luggage','lumber','lunar','lunch','luxury','lyrics','machine','mad','magic','magnet','maid','mail','main','major','make','mammal','man','manage','mandate','mango','mansion','manual','maple','marble','march','margin','marine','market','marriage','mask','mass','master','match','material','math','matrix','matter','maximum','maze','meadow','mean','measure','meat','mechanic','medal','media','melody','melt','member','memory','mention','menu','mercy','merge','merit','merry','mesh','message','metal','method','middle','midnight','milk','million','mimic','mind','minimum','minor','minute','miracle','mirror','misery','miss','mistake','mix','mixed','mixture','mobile','model','modify','mom','moment','monitor','monkey','monster','month','moon','moral','more','morning','mosquito','mother','motion','motor','mountain','mouse','move','movie','much','muffin','mule','multiply','muscle','museum','mushroom','music','must','mutual','myself','mystery','myth','naive','name','napkin','narrow','nasty','nation','nature','near','neck','need','negative','neglect','neither','nephew','nerve','nest','net','network','neutral','never','news','next','nice','night','noble','noise','nominee','noodle','normal','north','nose','notable','note','nothing','notice','novel','now','nuclear','number','nurse','nut','oak','obey','object','oblige','obscure','observe','obtain','obvious','occur','ocean','october','odor','off','offer','office','often','oil','okay','old','olive','olympic','omit','once','one','onion','online','only','open','opera','opinion','oppose','option','orange','orbit','orchard','order','ordinary','organ','orient','original','orphan','ostrich','other','outdoor','outer','output','outside','oval','oven','over','own','owner','oxygen','oyster','ozone','pact','paddle','page','pair','palace','palm','panda','panel','panic','panther','paper','parade','parent','park','parrot','party','pass','patch','path','patient','patrol','pattern','pause','pave','payment','peace','peanut','pear','peasant','pelican','pen','penalty','pencil','people','pepper','perfect','permit','person','pet','phone','photo','phrase','physical','piano','picnic','picture','piece','pig','pigeon','pill','pilot','pink','pioneer','pipe','pistol','pitch','pizza','place','planet','plastic','plate','play','please','pledge','pluck','plug','plunge','poem','poet','point','polar','pole','police','pond','pony','pool','popular','portion','position','possible','post','potato','pottery','poverty','powder','power','practice','praise','predict','prefer','prepare','present','pretty','prevent','price','pride','primary','print','priority','prison','private','prize','problem','process','produce','profit','program','project','promote','proof','property','prosper','protect','proud','provide','public','pudding','pull','pulp','pulse','pumpkin','punch','pupil','puppy','purchase','purity','purpose','purse','push','put','puzzle','pyramid','quality','quantum','quarter','question','quick','quit','quiz','quote','rabbit','raccoon','race','rack','radar','radio','rail','rain','raise','rally','ramp','ranch','random','range','rapid','rare','rate','rather','raven','raw','razor','ready','real','reason','rebel','rebuild','recall','receive','recipe','record','recycle','reduce','reflect','reform','refuse','region','regret','regular','reject','relax','release','relief','rely','remain','remember','remind','remove','render','renew','rent','reopen','repair','repeat','replace','report','require','rescue','resemble','resist','resource','response','result','retire','retreat','return','reunion','reveal','review','reward','rhythm','rib','ribbon','rice','rich','ride','ridge','rifle','right','rigid','ring','riot','ripple','risk','ritual','rival','river','road','roast','robot','robust','rocket','romance','roof','rookie','room','rose','rotate','rough','round','route','royal','rubber','rude','rug','rule','run','runway','rural','sad','saddle','sadness','safe','sail','salad','salmon','salon','salt','salute','same','sample','sand','satisfy','satoshi','sauce','sausage','save','say','scale','scan','scare','scatter','scene','scheme','school','science','scissors','scorpion','scout','scrap','screen','script','scrub','sea','search','season','seat','second','secret','section','security','seed','seek','segment','select','sell','seminar','senior','sense','sentence','series','service','session','settle','setup','seven','shadow','shaft','shallow','share','shed','shell','sheriff','shield','shift','shine','ship','shiver','shock','shoe','shoot','shop','short','shoulder','shove','shrimp','shrug','shuffle','shy','sibling','sick','side','siege','sight','sign','silent','silk','silly','silver','similar','simple','since','sing','siren','sister','situate','six','size','skate','sketch','ski','skill','skin','skirt','skull','slab','slam','sleep','slender','slice','slide','slight','slim','slogan','slot','slow','slush','small','smart','smile','smoke','smooth','snack','snake','snap','sniff','snow','soap','soccer','social','sock','soda','soft','solar','soldier','solid','solution','solve','someone','song','soon','sorry','sort','soul','sound','soup','source','south','space','spare','spatial','spawn','speak','special','speed','spell','spend','sphere','spice','spider','spike','spin','spirit','split','spoil','sponsor','spoon','sport','spot','spray','spread','spring','spy','square','squeeze','squirrel','stable','stadium','staff','stage','stairs','stamp','stand','start','state','stay','steak','steel','stem','step','stereo','stick','still','sting','stock','stomach','stone','stool','story','stove','strategy','street','strike','strong','struggle','student','stuff','stumble','style','subject','submit','subway','success','such','sudden','suffer','sugar','suggest','suit','summer','sun','sunny','sunset','super','supply','supreme','sure','surface','surge','surprise','surround','survey','suspect','sustain','swallow','swamp','swap','swarm','swear','sweet','swift','swim','swing','switch','sword','symbol','symptom','syrup','system','table','tackle','tag','tail','talent','talk','tank','tape','target','task','taste','tattoo','taxi','teach','team','tell','ten','tenant','tennis','tent','term','test','text','thank','that','theme','then','theory','there','they','thing','this','thought','three','thrive','throw','thumb','thunder','ticket','tide','tiger','tilt','timber','time','tiny','tip','tired','tissue','title','toast','tobacco','today','toddler','toe','together','toilet','token','tomato','tomorrow','tone','tongue','tonight','tool','tooth','top','topic','topple','torch','tornado','tortoise','toss','total','tourist','toward','tower','town','toy','track','trade','traffic','tragic','train','transfer','trap','trash','travel','tray','treat','tree','trend','trial','tribe','trick','trigger','trim','trip','trophy','trouble','truck','true','truly','trumpet','trust','truth','try','tube','tuition','tumble','tuna','tunnel','turkey','turn','turtle','twelve','twenty','twice','twin','twist','two','type','typical','ugly','umbrella','unable','unaware','uncle','uncover','under','undo','unfair','unfold','unhappy','uniform','unique','unit','universe','unknown','unlock','until','unusual','unveil','update','upgrade','uphold','upon','upper','upset','urban','urge','usage','use','used','useful','useless','usual','utility','vacant','vacuum','vague','valid','valley','valve','van','vanish','vapor','various','vast','vault','vehicle','velvet','vendor','venture','venue','verb','verify','version','very','vessel','veteran','viable','vibrant','vicious','victory','video','view','village','vintage','violin','virtual','virus','visa','visit','visual','vital','vivid','vocal','voice','void','volcano','volume','vote','voyage','wage','wagon','wait','walk','wall','walnut','want','warfare','warm','warrior','wash','wasp','waste','water','wave','way','wealth','weapon','wear','weasel','weather','web','wedding','weekend','weird','welcome','west','wet','whale','what','wheat','wheel','when','where','whip','whisper','wide','width','wife','wild','will','win','window','wine','wing','wink','winner','winter','wire','wisdom','wise','wish','witness','wolf','woman','wonder','wood','wool','word','work','world','worry','worth','wrap','wreck','wrestle','wrist','write','wrong','yard','year','yellow','you','young','youth','zebra','zero','zone','zoo'];

const WORDLIST=[];

// ========== 加密工具：支持无 SubtleCrypto 的离线环境 ==========
const cryptoObj = (typeof globalThis !== 'undefined' && globalThis.crypto) ? globalThis.crypto : null;
const hasSubtleCrypto = !!(cryptoObj && (typeof cryptoObj.subtle === 'object' || typeof cryptoObj.subtle === 'function'));

function ensureUint8Array(data) {
  if (data instanceof Uint8Array) return data;
  if (ArrayBuffer.isView(data)) {
    return new Uint8Array(data.buffer, data.byteOffset, data.byteLength);
  }
  if (data instanceof ArrayBuffer) {
    return new Uint8Array(data);
  }
  throw new TypeError('预期为 Uint8Array 或 ArrayBuffer');
}

function bytesToHex(bytes) {
  return Array.from(bytes).map(b => b.toString(16).padStart(2, '0')).join('');
}

function concatBytes(...arrays) {
  const length = arrays.reduce((sum, arr) => sum + arr.length, 0);
  const result = new Uint8Array(length);
  let offset = 0;
  for (const arr of arrays) {
    result.set(arr, offset);
    offset += arr.length;
  }
  return result;
}

// SHA-256 常量
const SHA256_IV_FALLBACK = new Uint32Array([
  0x6a09e667, 0xbb67ae85, 0x3c6ef372, 0xa54ff53a,
  0x510e527f, 0x9b05688c, 0x1f83d9ab, 0x5be0cd19
]);

const SHA256_K_FALLBACK = new Uint32Array([
  0x428a2f98, 0x71374491, 0xb5c0fbcf, 0xe9b5dba5, 0x3956c25b, 0x59f111f1, 0x923f82a4, 0xab1c5ed5,
  0xd807aa98, 0x12835b01, 0x243185be, 0x550c7dc3, 0x72be5d74, 0x80deb1fe, 0x9bdc06a7, 0xc19bf174,
  0xe49b69c1, 0xefbe4786, 0x0fc19dc6, 0x240ca1cc, 0x2de92c6f, 0x4a7484aa, 0x5cb0a9dc, 0x76f988da,
  0x983e5152, 0xa831c66d, 0xb00327c8, 0xbf597fc7, 0xc6e00bf3, 0xd5a79147, 0x06ca6351, 0x14292967,
  0x27b70a85, 0x2e1b2138, 0x4d2c6dfc, 0x53380d13, 0x650a7354, 0x766a0abb, 0x81c2c92e, 0x92722c85,
  0xa2bfe8a1, 0xa81a664b, 0xc24b8b70, 0xc76c51a3, 0xd192e819, 0xd6990624, 0xf40e3585, 0x106aa070,
  0x19a4c116, 0x1e376c08, 0x2748774c, 0x34b0bcb5, 0x391c0cb3, 0x4ed8aa4a, 0x5b9cca4f, 0x682e6ff3,
  0x748f82ee, 0x78a5636f, 0x84c87814, 0x8cc70208, 0x90befffa, 0xa4506ceb, 0xbef9a3f7, 0xc67178f2
]);

function rotr32(x, n) {
  return (x >>> n) | (x << (32 - n));
}

function sha256Fallback(data) {
  const bytes = ensureUint8Array(data);
  const byteLength = bytes.length;
  const bitLength = byteLength * 8;
  const paddedLength = ((byteLength + 9 + 63) >>> 6) << 6;
  const padded = new Uint8Array(paddedLength);
  padded.set(bytes);
  padded[byteLength] = 0x80;

  const view = new DataView(padded.buffer);
  const high = Math.floor(bitLength / 0x100000000);
  const low = bitLength >>> 0;
  view.setUint32(paddedLength - 8, high, false);
  view.setUint32(paddedLength - 4, low, false);

  const w = new Uint32Array(64);
  let [a, b, c, d, e, f, g, h] = SHA256_IV_FALLBACK;

  for (let offset = 0; offset < paddedLength; offset += 64) {
    for (let i = 0; i < 16; i++) {
      w[i] = view.getUint32(offset + i * 4, false);
    }
    for (let i = 16; i < 64; i++) {
      const s0 = rotr32(w[i - 15], 7) ^ rotr32(w[i - 15], 18) ^ (w[i - 15] >>> 3);
      const s1 = rotr32(w[i - 2], 17) ^ rotr32(w[i - 2], 19) ^ (w[i - 2] >>> 10);
      w[i] = (w[i - 16] + s0 + w[i - 7] + s1) >>> 0;
    }

    let A = a, B = b, C = c, D = d, E = e, F = f, G = g, H = h;
    for (let i = 0; i < 64; i++) {
      const S1 = rotr32(E, 6) ^ rotr32(E, 11) ^ rotr32(E, 25);
      const ch = (E & F) ^ (~E & G);
      const temp1 = (H + S1 + ch + SHA256_K_FALLBACK[i] + w[i]) >>> 0;
      const S0 = rotr32(A, 2) ^ rotr32(A, 13) ^ rotr32(A, 22);
      const maj = (A & B) ^ (A & C) ^ (B & C);
      const temp2 = (S0 + maj) >>> 0;

      H = G;
      G = F;
      F = E;
      E = (D + temp1) >>> 0;
      D = C;
      C = B;
      B = A;
      A = (temp1 + temp2) >>> 0;
    }

    a = (a + A) >>> 0;
    b = (b + B) >>> 0;
    c = (c + C) >>> 0;
    d = (d + D) >>> 0;
    e = (e + E) >>> 0;
    f = (f + F) >>> 0;
    g = (g + G) >>> 0;
    h = (h + H) >>> 0;
  }

  const result = new Uint8Array(32);
  const words = [a, b, c, d, e, f, g, h];
  for (let i = 0; i < words.length; i++) {
    result[i * 4] = (words[i] >>> 24) & 0xff;
    result[i * 4 + 1] = (words[i] >>> 16) & 0xff;
    result[i * 4 + 2] = (words[i] >>> 8) & 0xff;
    result[i * 4 + 3] = words[i] & 0xff;
  }
  return result;
}

// SHA-512 常量
const SHA512_IV_FALLBACK = [
  0x6a09e667f3bcc908n, 0xbb67ae8584caa73bn, 0x3c6ef372fe94f82bn, 0xa54ff53a5f1d36f1n,
  0x510e527fade682d1n, 0x9b05688c2b3e6c1fn, 0x1f83d9abfb41bd6bn, 0x5be0cd19137e2179n
];

const SHA512_K_FALLBACK = [
  0x428a2f98d728ae22n, 0x7137449123ef65cdn, 0xb5c0fbcfec4d3b2fn, 0xe9b5dba58189dbbcn,
  0x3956c25bf348b538n, 0x59f111f1b605d019n, 0x923f82a4af194f9bn, 0xab1c5ed5da6d8118n,
  0xd807aa98a3030242n, 0x12835b0145706fben, 0x243185be4ee4b28cn, 0x550c7dc3d5ffb4e2n,
  0x72be5d74f27b896fn, 0x80deb1fe3b1696b1n, 0x9bdc06a725c71235n, 0xc19bf174cf692694n,
  0xe49b69c19ef14ad2n, 0xefbe4786384f25e3n, 0x0fc19dc68b8cd5b5n, 0x240ca1cc77ac9c65n,
  0x2de92c6f592b0275n, 0x4a7484aa6ea6e483n, 0x5cb0a9dcbd41fbd4n, 0x76f988da831153b5n,
  0x983e5152ee66dfabn, 0xa831c66d2db43210n, 0xb00327c898fb213fn, 0xbf597fc7beef0ee4n,
  0xc6e00bf33da88fc2n, 0xd5a79147930aa725n, 0x06ca6351e003826fn, 0x142929670a0e6e70n,
  0x27b70a8546d22ffcn, 0x2e1b21385c26c926n, 0x4d2c6dfc5ac42aedn, 0x53380d139d95b3dfn,
  0x650a73548baf63den, 0x766a0abb3c77b2a8n, 0x81c2c92e47edaee6n, 0x92722c851482353bn,
  0xa2bfe8a14cf10364n, 0xa81a664bbc423001n, 0xc24b8b70d0f89791n, 0xc76c51a30654be30n,
  0xd192e819d6ef5218n, 0xd69906245565a910n, 0xf40e35855771202an, 0x106aa07032bbd1b8n,
  0x19a4c116b8d2d0c8n, 0x1e376c085141ab53n, 0x2748774cdf8eeb99n, 0x34b0bcb5e19b48a8n,
  0x391c0cb3c5c95a63n, 0x4ed8aa4ae3418acbn, 0x5b9cca4f7763e373n, 0x682e6ff3d6b2b8a3n,
  0x748f82ee5defb2fcn, 0x78a5636f43172f60n, 0x84c87814a1f0ab72n, 0x8cc702081a6439ecn,
  0x90befffa23631e28n, 0xa4506cebde82bde9n, 0xbef9a3f7b2c67915n, 0xc67178f2e372532bn,
  0xca273eceea26619cn, 0xd186b8c721c0c207n, 0xeada7dd6cde0eb1en, 0xf57d4f7fee6ed178n,
  0x06f067aa72176fban, 0x0a637dc5a2c898a6n, 0x113f9804bef90daen, 0x1b710b35131c471bn,
  0x28db77f523047d84n, 0x32caab7b40c72493n, 0x3c9ebe0a15c9bebcn, 0x431d67c49c100d4cn,
  0x4cc5d4becb3e42b6n, 0x597f299cfc657e2an, 0x5fcb6fab3ad6faecn, 0x6c44198c4a475817n
];

const BIG_64 = 0xffffffffffffffffn;

function rotr64(x, n) {
  const shift = BigInt(n);
  return ((x >> shift) | (x << (64n - shift))) & BIG_64;
}

function sha512Fallback(data) {
  const bytes = ensureUint8Array(data);
  const byteLength = bytes.length;
  const bitLength = BigInt(byteLength) * 8n;
  const paddedLength = ((byteLength + 17 + 127) >>> 7) << 7;
  const padded = new Uint8Array(paddedLength);
  padded.set(bytes);
  padded[byteLength] = 0x80;

  let len = bitLength;
  for (let i = 0; i < 16; i++) {
    padded[paddedLength - 1 - i] = Number(len & 0xffn);
    len >>= 8n;
  }

  const view = new DataView(padded.buffer);
  const w = new Array(80).fill(0n);
  let [a, b, c, d, e, f, g, h] = SHA512_IV_FALLBACK;

  for (let offset = 0; offset < paddedLength; offset += 128) {
    for (let i = 0; i < 16; i++) {
      const high = BigInt(view.getUint32(offset + i * 8, false));
      const low = BigInt(view.getUint32(offset + i * 8 + 4, false));
      w[i] = ((high << 32n) | low) & BIG_64;
    }
    for (let i = 16; i < 80; i++) {
      const s0 = rotr64(w[i - 15], 1) ^ rotr64(w[i - 15], 8) ^ (w[i - 15] >> 7n);
      const s1 = rotr64(w[i - 2], 19) ^ rotr64(w[i - 2], 61) ^ (w[i - 2] >> 6n);
      w[i] = (w[i - 16] + s0 + w[i - 7] + s1) & BIG_64;
    }

    let A = a, B = b, C = c, D = d, E = e, F = f, G = g, H = h;
    for (let i = 0; i < 80; i++) {
      const S1 = rotr64(E, 14) ^ rotr64(E, 18) ^ rotr64(E, 41);
      const ch = (E & F) ^ ((~E) & G);
      const temp1 = (H + S1 + ch + SHA512_K_FALLBACK[i] + w[i]) & BIG_64;
      const S0 = rotr64(A, 28) ^ rotr64(A, 34) ^ rotr64(A, 39);
      const maj = (A & B) ^ (A & C) ^ (B & C);
      const temp2 = (S0 + maj) & BIG_64;

      H = G;
      G = F;
      F = E;
      E = (D + temp1) & BIG_64;
      D = C;
      C = B;
      B = A;
      A = (temp1 + temp2) & BIG_64;
    }

    a = (a + A) & BIG_64;
    b = (b + B) & BIG_64;
    c = (c + C) & BIG_64;
    d = (d + D) & BIG_64;
    e = (e + E) & BIG_64;
    f = (f + F) & BIG_64;
    g = (g + G) & BIG_64;
    h = (h + H) & BIG_64;
  }

  const result = new Uint8Array(64);
  const words = [a, b, c, d, e, f, g, h];
  for (let i = 0; i < words.length; i++) {
    let word = words[i];
    for (let j = 0; j < 8; j++) {
      result[i * 8 + j] = Number((word >> BigInt(56 - 8 * j)) & 0xffn);
    }
  }
  return result;
}

function hmacSha512Fallback(key, data) {
  const blockSize = 128;
  let keyBytes = ensureUint8Array(key);
  if (keyBytes.length > blockSize) {
    keyBytes = sha512Fallback(keyBytes);
  }
  const oKeyPad = new Uint8Array(blockSize);
  const iKeyPad = new Uint8Array(blockSize);
  for (let i = 0; i < blockSize; i++) {
    const keyByte = i < keyBytes.length ? keyBytes[i] : 0;
    iKeyPad[i] = keyByte ^ 0x36;
    oKeyPad[i] = keyByte ^ 0x5c;
  }
  const inner = sha512Fallback(concatBytes(iKeyPad, ensureUint8Array(data)));
  return sha512Fallback(concatBytes(oKeyPad, inner));
}

function pbkdf2HmacSha512Fallback(password, salt, iterations, dkLen) {
  const passBytes = ensureUint8Array(password);
  const saltBytes = ensureUint8Array(salt);
  const hashLen = 64;
  const blockCount = Math.ceil(dkLen / hashLen);
  const dk = new Uint8Array(blockCount * hashLen);
  const block = new Uint8Array(saltBytes.length + 4);
  block.set(saltBytes, 0);

  for (let blockIndex = 1; blockIndex <= blockCount; blockIndex++) {
    block[saltBytes.length] = (blockIndex >>> 24) & 0xff;
    block[saltBytes.length + 1] = (blockIndex >>> 16) & 0xff;
    block[saltBytes.length + 2] = (blockIndex >>> 8) & 0xff;
    block[saltBytes.length + 3] = blockIndex & 0xff;

    let u = hmacSha512Fallback(passBytes, block);
    const t = new Uint8Array(u);

    for (let i = 1; i < iterations; i++) {
      u = hmacSha512Fallback(passBytes, u);
      for (let j = 0; j < hashLen; j++) {
        t[j] ^= u[j];
      }
    }

    dk.set(t, (blockIndex - 1) * hashLen);
  }

  return dk.slice(0, dkLen);
}

async function sha256Bytes(data) {
  if (hasSubtleCrypto && cryptoObj?.subtle) {
    const digest = await cryptoObj.subtle.digest('SHA-256', ensureUint8Array(data));
    return new Uint8Array(digest);
  }
  return sha256Fallback(data);
}

async function hmacSha512(key, data) {
  if (hasSubtleCrypto && cryptoObj?.subtle) {
    const cryptoKey = await cryptoObj.subtle.importKey(
      'raw', ensureUint8Array(key), { name: 'HMAC', hash: 'SHA-512' }, false, ['sign']
    );
    const signature = await cryptoObj.subtle.sign('HMAC', cryptoKey, ensureUint8Array(data));
    return new Uint8Array(signature);
  }
  return hmacSha512Fallback(key, data);
}

async function pbkdf2HmacSha512(password, salt, iterations, dkLen) {
  if (hasSubtleCrypto && cryptoObj?.subtle) {
    const keyMaterial = await cryptoObj.subtle.importKey(
      'raw', ensureUint8Array(password), { name: 'PBKDF2' }, false, ['deriveBits']
    );
    const bits = await cryptoObj.subtle.deriveBits(
      { name: 'PBKDF2', salt: ensureUint8Array(salt), iterations, hash: 'SHA-512' },
      keyMaterial,
      dkLen * 8
    );
    return new Uint8Array(bits);
  }
  return pbkdf2HmacSha512Fallback(password, salt, iterations, dkLen);
}

async function sha256(buf){
  const digest = await sha256Bytes(buf);
  return bytesToHex(digest); // 64字符
}

// 将字节数组转换为位数组（大端序，每个字节的最高位在前）
function bytesToBits(bytes) {
  const bits = [];
  for (let b of bytes) {
    for (let i = 7; i >= 0; i--) {
      bits.push((b >> i) & 1);
    }
  }
  return bits;
}

// 将位数组转换为整数（大端序）
function bitsToInt(bits) {
  return bits.reduce((acc, b) => (acc << 1) | b, 0);
}

// BIP39: 从熵生成助记词（标准实现，确保不重复）
async function entropyToMnemonic(entropy, wordlist) {
  // 验证输入
  if (!entropy || entropy.length === 0) {
    throw new Error('熵不能为空');
  }
  if (!wordlist || wordlist.length !== 2048) {
    throw new Error('词表必须包含2048个单词');
  }
  
  const ENT = entropy.length * 8; // 熵的位数
  const checksumLen = ENT / 32; // 校验和位数（BIP39标准）
  
  // 计算SHA-256哈希作为校验和
  const hash = await sha256Bytes(entropy);
  
  // 组合：熵的位 + 校验和的前N位
  const entropyBits = bytesToBits(entropy);
  const checksumBits = bytesToBits(hash).slice(0, checksumLen);
  const allBits = entropyBits.concat(checksumBits);
  
  // 验证总位数：应该是11的倍数
  const expectedBits = Math.floor((ENT + checksumLen) / 11) * 11;
  if (allBits.length !== expectedBits) {
    throw new Error(`位数组长度不正确: ${allBits.length}, 期望: ${expectedBits}`);
  }
  
  // 每11位作为一个词表索引（0-2047）
  const chunks = [];
  const wordCount = allBits.length / 11;
  
  for (let i = 0; i < wordCount; i++) {
    const start = i * 11;
    const end = start + 11;
    const wordIndex = bitsToInt(allBits.slice(start, end));
    
    // 验证索引范围（0-2047）
    if (wordIndex < 0 || wordIndex >= 2048) {
      throw new Error(`词表索引超出范围: ${wordIndex}`);
    }
    
    chunks.push(wordlist[wordIndex]);
  }
  
  return chunks.join(" ");
}

// 生成加密安全的随机熵（使用浏览器原生 crypto.getRandomValues）
function generateEntropy(bytes) {
  if (bytes !== 16 && bytes !== 32) {
    throw new Error('熵长度必须是16字节（12词）或32字节（24词）');
  }

  const arr = new Uint8Array(bytes);
  // 使用浏览器原生加密安全随机数生成器
  if (!cryptoObj || typeof cryptoObj.getRandomValues !== 'function') {
    throw new Error('当前环境不支持安全随机数生成 (crypto.getRandomValues 不可用)');
  }
  cryptoObj.getRandomValues(arr);

  return arr;
}

// ========== 完整的比特币地址生成实现（标准兼容）==========

// 规范化助记词：trim、折叠多空格、转小写、NFKD归一化
// 根据文档要求：全部小写、单空格分隔
function normalizeMnemonic(mnemonic) {
  // 1. trim首尾空格
  let normalized = mnemonic.trim();
  
  // 2. 折叠多个连续空格为单个空格
  normalized = normalized.replace(/\s+/g, ' ');
  
  // 3. 转小写（BIP39要求）
  normalized = normalized.toLowerCase();
  
  // 4. Unicode NFKD归一化（BIP39要求）
  normalized = normalized.normalize('NFKD');
  
  return normalized;
}

// BIP39: 从助记词生成种子（支持可选口令）
// 根据BIP39规范：password="mnemonic", salt="mnemonic" + passphrase（NFKD归一化）
async function mnemonicToSeed(mnemonic, passphrase = '') {
  const encoder = new TextEncoder();

  // 1. 规范化助记词（trim、折叠空格、小写、NFKD）
  const normalizedMnemonic = normalizeMnemonic(mnemonic);

  // 2. 归一化口令（Unicode NFKD，空字符串也需归一化）
  const normalizedPassphrase = passphrase.normalize('NFKD');

  // 3. 准备PBKDF2参数
  const mnemonicBytes = encoder.encode(normalizedMnemonic);
  const saltBytes = encoder.encode('mnemonic' + normalizedPassphrase);

  // 4. PBKDF2-HMAC-SHA512: iterations=2048, output=64字节
  return pbkdf2HmacSha512(mnemonicBytes, saltBytes, 2048, 64);
}

// 完整的RIPEMD160实现（包含双链并行处理）
function ripemd160(bytes) {
  // 初始化哈希值（左链和右链）
  let h = [0x67452301, 0xEFCDAB89, 0x98BADCFE, 0x10325476, 0xC3D2E1F0];
  let h2 = [0x67452301, 0xEFCDAB89, 0x98BADCFE, 0x10325476, 0xC3D2E1F0];
  
  // 左链参数
  const r = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15,
    7, 4, 13, 1, 10, 6, 15, 3, 12, 0, 9, 5, 2, 14, 11, 8,
    3, 10, 14, 4, 9, 15, 8, 1, 2, 7, 0, 6, 13, 11, 5, 12,
    1, 9, 11, 10, 0, 8, 12, 4, 13, 3, 7, 15, 14, 5, 6, 2,
    4, 0, 5, 9, 7, 12, 2, 10, 14, 1, 3, 8, 11, 6, 15, 13];
  const s = [11, 14, 15, 12, 5, 8, 7, 9, 11, 13, 14, 15, 6, 7, 9, 8,
    7, 6, 8, 13, 11, 9, 7, 15, 7, 12, 15, 9, 11, 7, 13, 12,
    11, 13, 6, 7, 14, 9, 13, 15, 14, 8, 13, 6, 5, 12, 7, 5,
    11, 12, 14, 15, 14, 15, 9, 8, 9, 14, 5, 6, 8, 6, 5, 12,
    9, 15, 5, 11, 6, 8, 13, 12, 5, 12, 13, 14, 11, 8, 5, 6];
  
  // 右链参数
  const rr = [5, 14, 7, 0, 9, 2, 11, 4, 13, 6, 15, 8, 1, 10, 3, 12,
    6, 11, 3, 7, 0, 13, 5, 10, 14, 15, 8, 12, 4, 9, 1, 2,
    15, 5, 1, 3, 7, 14, 6, 9, 11, 8, 12, 2, 10, 0, 4, 13,
    8, 6, 4, 1, 3, 11, 15, 0, 5, 12, 2, 13, 9, 7, 10, 14,
    12, 15, 10, 4, 1, 5, 8, 7, 6, 2, 13, 14, 0, 3, 9, 11];
  const ss = [8, 9, 9, 11, 13, 15, 15, 5, 7, 7, 8, 11, 14, 14, 12, 6,
    9, 13, 15, 7, 12, 8, 9, 11, 7, 7, 12, 7, 6, 15, 13, 11,
    9, 7, 15, 11, 8, 6, 6, 14, 12, 13, 5, 14, 13, 13, 7, 5,
    15, 5, 8, 11, 14, 14, 6, 14, 6, 9, 12, 9, 12, 5, 15, 8,
    8, 5, 12, 9, 12, 5, 14, 6, 8, 13, 6, 5, 15, 13, 11, 11];
  
  const k = [0x00000000, 0x5A827999, 0x6ED9EBA1, 0x8F1BBCDC, 0xA953FD4E];
  const kk = [0x50A28BE6, 0x5C4DD124, 0x6D703EF3, 0x7A6D76E9, 0x00000000];
  
  // 准备消息
  const msg = Array.from(new Uint8Array(bytes));
  const ml = msg.length * 8;
  msg.push(0x80);
  while (msg.length % 64 !== 56) msg.push(0x00);
  
  const view = new DataView(new ArrayBuffer(8));
  view.setUint32(0, ml, true);
  view.setUint32(4, 0, true);
  const lengthBytes = new Uint8Array(view.buffer);
  for (let i = 0; i < 8; i++) msg.push(lengthBytes[i]);
  
  const rol = (x, n) => ((x << n) | (x >>> (32 - n))) >>> 0;
  
  // 处理每个512位块
  for (let chunk = 0; chunk < msg.length; chunk += 64) {
    const w = [];
    for (let i = 0; i < 16; i++) {
      w[i] = msg[chunk + i * 4] | (msg[chunk + i * 4 + 1] << 8) |
        (msg[chunk + i * 4 + 2] << 16) | (msg[chunk + i * 4 + 3] << 24);
    }
    
    // 左链和右链
    let [a, b, c, d, e] = h;
    let [aa, bb, cc, dd, ee] = h2;
    
    // 左链函数
    const f = (x, y, z, i) => {
      if (i < 16) return x ^ y ^ z;
      if (i < 32) return (x & y) | (~x & z);
      if (i < 48) return (x | ~y) ^ z;
      if (i < 64) return (x & z) | (y & ~z);
      return x ^ (y | ~z);
    };
    
    // 右链函数
    const ff = (x, y, z, i) => {
      if (i < 16) return x ^ y ^ z;
      if (i < 32) return (x & y) | (x & z) | (y & z);
      if (i < 48) return (x | ~y) ^ z;
      if (i < 64) return (x & z) | (y & ~z);
      return x ^ (y | ~z);
    };
    
    // 处理左链（80轮）
    for (let i = 0; i < 80; i++) {
      const t = (rol(a + f(b, c, d, i) + w[r[i]] + k[Math.floor(i / 16)], s[i]) + e) >>> 0;
      [a, e, d, c, b] = [e, d, rol(c, 10), b, t];
    }
    
    // 处理右链（80轮）
    for (let i = 0; i < 80; i++) {
      const t = (rol(aa + ff(bb, cc, dd, i) + w[rr[i]] + kk[Math.floor(i / 16)], ss[i]) + ee) >>> 0;
      [aa, ee, dd, cc, bb] = [ee, dd, rol(cc, 10), bb, t];
    }
    
    // 合并两条链（根据RIPEMD-160标准）
    // 左链结果是[a,b,c,d,e]，右链结果是[aa,bb,cc,dd,ee]
    // 合并使用旋转模式：t = h[1] + c + dd, h[1] = h[2] + d + ee, ...
    const temp = (h[1] + c + dd) >>> 0;
    h[1] = (h[2] + d + ee) >>> 0;
    h[2] = (h[3] + e + aa) >>> 0;
    h[3] = (h[4] + a + bb) >>> 0;
    h[4] = (h[0] + b + cc) >>> 0;
    h[0] = temp;
  }
  
  // 输出20字节哈希
  const result = new Uint8Array(20);
  for (let i = 0; i < 5; i++) {
    result[i * 4] = h[i] & 0xff;
    result[i * 4 + 1] = (h[i] >>> 8) & 0xff;
    result[i * 4 + 2] = (h[i] >>> 16) & 0xff;
    result[i * 4 + 3] = (h[i] >>> 24) & 0xff;
  }
  return result;
}

// Base58编码（保留用于兼容性，P2WPKH不使用）
function base58Encode(bytes) {
  const alphabet = '123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz';
  if (!bytes.length) return '';
  
  let num = 0n;
  for (const byte of bytes) num = num * 256n + BigInt(byte);
  
  let result = '';
  while (num > 0n) {
    result = alphabet[Number(num % 58n)] + result;
    num = num / 58n;
  }
  
  for (let i = 0; i < bytes.length && bytes[i] === 0; i++) result = '1' + result;
  return result;
}

// Bech32编码（用于P2WPKH地址）
// 将字节数组转换为5位值数组
function convertBits(bytes, fromBits, toBits) {
  let acc = 0;
  let bits = 0;
  const result = [];
  const maxv = (1 << toBits) - 1;
  
  for (let i = 0; i < bytes.length; i++) {
    acc = (acc << fromBits) | bytes[i];
    bits += fromBits;
    while (bits >= toBits) {
      bits -= toBits;
      result.push((acc >> bits) & maxv);
    }
  }
  if (bits > 0) {
    result.push((acc << (toBits - bits)) & maxv);
  }
  return result;
}

function bech32Encode(hrp, data) {
  const charset = 'qpzry9x8gf2tvdw0s3jn54khce6mua7l';
  
  // 将字节数组转换为5位值
  const data5bit = convertBits(data, 8, 5);
  
  // Bech32常量
  const GEN = [0x3b6a57b2, 0x26508e6d, 0x1ea119fa, 0x3d4233dd, 0x2a1462b3];
  
  // 计算BCH校验和
  const bech32Polymod = (values) => {
    let chk = 1;
    for (let i = 0; i < values.length; i++) {
      const top = chk >>> 25;
      chk = ((chk & 0x1ffffff) << 5) ^ values[i];
      for (let j = 0; j < 5; j++) {
        if ((top >>> j) & 1) {
          chk ^= GEN[j];
        }
      }
    }
    return chk;
  };
  
  // HRP展开（高位和低位交替）
  const hrpExpand = (hrp) => {
    const result = [];
    for (let i = 0; i < hrp.length; i++) {
      result.push(hrp.charCodeAt(i) >>> 5);
    }
    result.push(0);
    for (let i = 0; i < hrp.length; i++) {
      result.push(hrp.charCodeAt(i) & 31);
    }
    return result;
  };
  
  // 计算校验和
  const hrpData = hrpExpand(hrp);
  const values = [...hrpData, ...data5bit];
  const polymod = bech32Polymod([...values, 0, 0, 0, 0, 0, 0]) ^ 1;
  const checksum = [];
  for (let i = 0; i < 6; i++) {
    checksum.push((polymod >>> (5 * (5 - i))) & 31);
  }
  
  // 组合最终字符串
  const combined = [...data5bit, ...checksum];
  return hrp + '1' + combined.map(i => charset[i]).join('');
}

// Bech32编码，接受已经转换为5位值的数据（包含witness version）
function bech32EncodeWithVersion(hrp, data5bit) {
  const charset = 'qpzry9x8gf2tvdw0s3jn54khce6mua7l';
  
  // Bech32常量
  const GEN = [0x3b6a57b2, 0x26508e6d, 0x1ea119fa, 0x3d4233dd, 0x2a1462b3];
  
  // 计算BCH校验和
  const bech32Polymod = (values) => {
    let chk = 1;
    for (let i = 0; i < values.length; i++) {
      const top = chk >>> 25;
      chk = ((chk & 0x1ffffff) << 5) ^ values[i];
      for (let j = 0; j < 5; j++) {
        if ((top >>> j) & 1) {
          chk ^= GEN[j];
        }
      }
    }
    return chk;
  };
  
  // HRP展开（高位和低位交替）
  const hrpExpand = (hrp) => {
    const result = [];
    for (let i = 0; i < hrp.length; i++) {
      result.push(hrp.charCodeAt(i) >>> 5);
    }
    result.push(0);
    for (let i = 0; i < hrp.length; i++) {
      result.push(hrp.charCodeAt(i) & 31);
    }
    return result;
  };
  
  // 计算校验和
  const hrpData = hrpExpand(hrp);
  const values = [...hrpData, ...data5bit];
  const polymod = bech32Polymod([...values, 0, 0, 0, 0, 0, 0]) ^ 1;
  const checksum = [];
  for (let i = 0; i < 6; i++) {
    checksum.push((polymod >>> (5 * (5 - i))) & 31);
  }
  
  // 组合最终字符串
  const combined = [...data5bit, ...checksum];
  return hrp + '1' + combined.map(i => charset[i]).join('');
}

// secp256k1椭圆曲线参数
const secp256k1 = {
  p: 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEFFFFFC2Fn,
  n: 0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFEBAAEDCE6AF48A03BBFD25E8CD0364141n,
  Gx: 0x79BE667EF9DCBBAC55A06295CE870B07029BFCDB2DCE28D959F2815B16F81798n,
  Gy: 0x483ADA7726A3C4655DA4FBFC0E1108A8FD17B448A68554199C47D08FFB10D4B8n
};

// 模运算工具
function mod(a, b) {
  return ((a % b) + b) % b;
}

// 模逆元（扩展欧几里得算法）
function modInverse(a, m) {
  // 修复：如果a为0，应该抛出错误而不是返回0（避免静默错误）
  if (a === 0n) {
    throw new Error('模逆元：0没有模逆元');
  }
  let [lm, hm] = [1n, 0n];
  let [low, high] = [mod(a, m), m];
  while (low > 1n) {
    const r = high / low;
    [high, low] = [low, mod(high, low)];
    [lm, hm] = [hm - r * lm, lm];
  }
  return mod(lm, m);
}

// 椭圆曲线点加
function pointAdd(p1, p2) {
  if (!p1) return p2;
  if (!p2) return p1;
  
  const [x1, y1] = p1;
  const [x2, y2] = p2;
  
  if (x1 === x2) {
    if (y1 === y2) {
      // 点倍乘：如果y1 == 0，则斜率不存在（2*y1 == 0），返回无穷远点
      if (y1 === 0n) {
        return null; // 无穷远点
      }
      const s = (3n * x1 * x1) * modInverse(2n * y1, secp256k1.p) % secp256k1.p;
      const x3 = (s * s - 2n * x1) % secp256k1.p;
      const y3 = (s * (x1 - x3) - y1) % secp256k1.p;
      return [mod(x3, secp256k1.p), mod(y3, secp256k1.p)];
    }
    // 一般加法：如果x1==x2且y1==-y2 (mod p)，则返回无穷远点
    if ((y1 + y2) % secp256k1.p === 0n) {
      return null; // 无穷远点
    }
    return null; // 无穷远点（这种情况不应该发生，因为x1==x2且y1!=y2且y1!=-y2是不可能的）
  }
  
  const s = (y2 - y1) * modInverse(x2 - x1, secp256k1.p) % secp256k1.p;
  const x3 = (s * s - x1 - x2) % secp256k1.p;
  const y3 = (s * (x1 - x3) - y1) % secp256k1.p;
  return [mod(x3, secp256k1.p), mod(y3, secp256k1.p)];
}

// 标量乘法（二进制快速算法，迭代版本避免栈溢出）
function scalarMult(k, point) {
  if (k === 0n || !point) return null;
  if (k === 1n) return point;
  if (k < 0n) throw new Error('标量必须为正数');
  
  let result = null;
  let addend = point;
  let scalar = k;
  
  while (scalar > 0n) {
    if (scalar & 1n) {
      result = result ? pointAdd(result, addend) : addend;
    }
    addend = pointAdd(addend, addend);
    scalar = scalar >> 1n;
  }
  
  return result;
}

// 从私钥生成公钥
function privateKeyToPublicKey(privateKey) {
  // 验证私钥不为0且在有效范围内
  const k = BigInt('0x' + Array.from(privateKey).map(b => b.toString(16).padStart(2, '0')).join(''));
  if (k === 0n || k >= secp256k1.n) {
    throw new Error('无效的私钥：超出有效范围');
  }
  
  const publicPoint = scalarMult(k, [secp256k1.Gx, secp256k1.Gy]);
  if (!publicPoint) throw new Error('无效的私钥：无法生成公钥');
  
  const [x, y] = publicPoint;
  
  // 确保坐标在有效范围内
  if (x < 0n || x >= secp256k1.p || y < 0n || y >= secp256k1.p) {
    throw new Error('生成的公钥坐标无效');
  }
  
  // 将坐标转换为字节数组（大端序）
  const xBytes = new Uint8Array(32);
  const yBytes = new Uint8Array(32);
  
  let xVal = x;
  let yVal = y;
  for (let i = 31; i >= 0; i--) {
    xBytes[i] = Number(xVal & 0xffn);
    yBytes[i] = Number(yVal & 0xffn);
    xVal = xVal >> 8n;
    yVal = yVal >> 8n;
  }
  
  // 未压缩公钥格式 (0x04 + x + y) - 传统格式（已废弃）
  // 压缩公钥格式 (0x02/0x03 + x) - 用于BIP32派生和BIP84地址生成
  const uncompressedKey = new Uint8Array(65);
  uncompressedKey[0] = 0x04;
  uncompressedKey.set(xBytes, 1);
  uncompressedKey.set(yBytes, 33);
  
  return uncompressedKey;
}

// 从私钥生成压缩公钥（用于BIP32派生和BIP84地址生成）
function privateKeyToCompressedPublicKey(privateKey) {
  const k = BigInt('0x' + Array.from(privateKey).map(b => b.toString(16).padStart(2, '0')).join(''));
  if (k === 0n || k >= secp256k1.n) {
    throw new Error('无效的私钥');
  }
  
  const publicPoint = scalarMult(k, [secp256k1.Gx, secp256k1.Gy]);
  if (!publicPoint) throw new Error('无效的私钥');
  
  const [x, y] = publicPoint;
  
  // ★ 关键修复：X 坐标转 hex 后，左侧补零到 64 个十六进制字符（即 32 字节）
  let xHex = x.toString(16);
  xHex = xHex.padStart(64, '0');  // 必须左补零到 64 hex 字符（32 字节）
  
  const xBytes = new Uint8Array(32);
  for (let i = 0; i < 32; i++) {
    xBytes[i] = parseInt(xHex.slice(i * 2, i * 2 + 2), 16);
  }
  
  // 压缩公钥格式 (0x02 if y even, 0x03 if y odd + x)
  const prefix = (y & 1n) === 0n ? 0x02 : 0x03;
  const compressedKey = new Uint8Array(33);
  compressedKey[0] = prefix;
  compressedKey.set(xBytes, 1);
  
  // 断言：防回归
  console.assert(compressedKey.length === 33, '压缩公钥长度必须是 33 字节');
  console.assert(compressedKey[0] === 0x02 || compressedKey[0] === 0x03, '压缩公钥前缀必须是 0x02 或 0x03');
  
  return compressedKey;
}

// BIP32: 从种子派生主密钥
async function deriveMasterKey(seed) {
  const I = await hmacSha512(new TextEncoder().encode('Bitcoin seed'), seed);
  const IL = I.slice(0, 32); // 左32字节
  const chainCode = I.slice(32);
  
  // BIP32合法性检查：IL必须 < n 且 != 0
  const ILInt = BigInt('0x' + Array.from(IL).map(b => b.toString(16).padStart(2, '0')).join(''));
  if (ILInt === 0n || ILInt >= secp256k1.n) {
    throw new Error('BIP32主密钥无效：IL == 0 或 IL >= n（概率极低，约1/2^256）');
  }
  
  return { key: IL, chainCode };
}

// BIP32: 派生子密钥（如果派生失败会抛出错误，调用者应尝试下一个索引）
async function deriveChildKey(parentKey, parentChainCode, index, hardened = false) {
  const indexBuffer = new Uint8Array(4);
  const indexVal = hardened ? index + 0x80000000 : index;
  indexBuffer[0] = (indexVal >>> 24) & 0xff;
  indexBuffer[1] = (indexVal >>> 16) & 0xff;
  indexBuffer[2] = (indexVal >>> 8) & 0xff;
  indexBuffer[3] = indexVal & 0xff;
  
  const data = new Uint8Array(37);
  if (hardened) {
    // 硬化派生：0x00 + 父私钥(32字节) + 索引(4字节)
    data[0] = 0x00;
    data.set(parentKey, 1);
    data.set(indexBuffer, 33);
  } else {
    // 非硬化派生：压缩公钥(33字节) + 索引(4字节)
    const publicKey = privateKeyToCompressedPublicKey(parentKey);
    // 断言：防回归
    console.assert(publicKey.length === 33, '压缩公钥长度必须是 33 字节');
    console.assert(publicKey[0] === 0x02 || publicKey[0] === 0x03, '压缩公钥前缀必须是 0x02 或 0x03');
    data.set(publicKey, 0);
    data.set(indexBuffer, 33);
  }
  
  // 断言：HMAC 输入长度必须是 37 字节
  console.assert(data.length === 37, 'HMAC 输入长度必须是 37 字节');
  
  const I = await hmacSha512(parentChainCode, data);
  const IL = I.slice(0, 32); // 左32字节（BIP32称为IL）
  const childChainCode = I.slice(32);
  
  // BIP32合法性检查：IL必须 < n 且 != 0
  const ILInt = BigInt('0x' + Array.from(IL).map(b => b.toString(16).padStart(2, '0')).join(''));
  if (ILInt === 0n || ILInt >= secp256k1.n) {
    throw new Error('派生出的私钥无效：IL == 0 或 IL >= n（BIP32标准要求，应尝试下一个索引）');
  }
  
  // 计算实际的子私钥（需要模n运算）
  const parentKeyInt = BigInt('0x' + Array.from(parentKey).map(b => b.toString(16).padStart(2, '0')).join(''));
  let actualKeyInt = (parentKeyInt + ILInt) % secp256k1.n;
  
  // 根据BIP32标准：最终结果必须 != 0（由于使用了模运算，actualKeyInt永远不会>=n）
  // 如果结果为0，这是无效的（概率极低，约1/2^256），应尝试下一个索引
  if (actualKeyInt === 0n) {
    throw new Error('派生出的私钥无效（结果为0），这是BIP32标准要求，应尝试下一个索引');
  }
  
  // 转换为字节数组（大端序）
  const actualKey = new Uint8Array(32);
  let val = actualKeyInt;
  for (let i = 31; i >= 0; i--) {
    actualKey[i] = Number(val & 0xffn);
    val = val >> 8n;
  }
  
  // 清零临时变量（安全措施）
  // 注意：这里不清零 parentKey，因为它是外部传入的参数
  // IL 是临时计算值，会在返回后被覆盖
  
  return { key: actualKey, chainCode: childChainCode };
}

// BIP84: 派生路径 m/84'/0'/0'/0/0 (Native SegWit P2WPKH)
// 严格按照BIP84标准路径，如果派生失败会抛出错误
async function deriveBIP84Key(seed, account = 0, change = 0, addressIndex = 0) {
  const master = await deriveMasterKey(seed);
  
  // m/84'
  let key = master.key;
  let chainCode = master.chainCode;
  const step1 = await deriveChildKey(key, chainCode, 84, true);
  // 清零上一步的key（不再需要）
  key.fill(0);
  
  // m/84'/0'
  key = step1.key;
  chainCode = step1.chainCode;
  const step2 = await deriveChildKey(key, chainCode, 0, true);
  key.fill(0);
  
  // m/84'/0'/0'
  key = step2.key;
  chainCode = step2.chainCode;
  const step3 = await deriveChildKey(key, chainCode, account, true);
  key.fill(0);
  
  // m/84'/0'/0'/0
  key = step3.key;
  chainCode = step3.chainCode;
  const step4 = await deriveChildKey(key, chainCode, change, false);
  key.fill(0);
  
  // m/84'/0'/0'/0/0
  key = step4.key;
  chainCode = step4.chainCode;
  const step5 = await deriveChildKey(key, chainCode, addressIndex, false);
  
  // 清零中间步骤的key（不再需要）
  key.fill(0);
  // 清零master key
  master.key.fill(0);
  
  return step5.key;
}

// ========== 使用标准库的比特币地址生成实现 ==========
// 使用 @scure/bip39, @scure/bip32, @noble/hashes, @scure/base 替换手写实现

/** 将 8bit 字节转换为 5bit（Bech32 用） */
function convertBits(data, from = 8, to = 5, pad = true) {
  let acc = 0, bits = 0;
  const maxv = (1 << to) - 1;
  const out = [];
  
  for (const v of data) {
    if (v < 0 || (v >> from) !== 0) throw new Error('convertBits: invalid value');
    acc = (acc << from) | v;
    bits += from;
    while (bits >= to) {
      bits -= to;
      out.push((acc >> bits) & maxv);
    }
  }
  
  if (pad) {
    if (bits) out.push((acc << (to - bits)) & maxv);
  } else if (bits >= from || ((acc << (to - bits)) & maxv)) {
    throw new Error('convertBits: invalid padding');
  }
  
  return Uint8Array.from(out);
}

// 地址生成实现（本地优先，可选CDN校验）
let p2wpkhFromMnemonic = null;
let localImplementationReady = false;
let localValidated = false;
let scureAttempted = false;
let scureChecker = null;

async function computeAddressLocal(mnemonic, passphrase = '', account = 0, change = 0, index = 0) {
  // 1. BIP39: 从助记词生成种子
  const seed = await mnemonicToSeed(mnemonic, passphrase);

  try {
    // 2. BIP84: 派生私钥
    const privateKey = await deriveBIP84Key(seed, account, change, index);

    try {
      // 3. 从私钥生成压缩公钥（已修复X坐标补零问题）
      const publicKey = privateKeyToCompressedPublicKey(privateKey);

      // 4. 计算公钥哈希 (SHA256 + RIPEMD160)
      const sha256Hash = await sha256Bytes(publicKey);
      const pubKeyHash = ripemd160(sha256Hash);

      // 5. P2WPKH地址格式
      const witnessVersion = 0;
      const data5bit = Array.from(convertBits(pubKeyHash, 8, 5));
      const dataWithVersion = [witnessVersion, ...data5bit];

      // 6. Bech32编码
      const address = bech32EncodeWithVersion('bc', dataWithVersion);

      return address;
    } finally {
      // 清零私钥
      privateKey.fill(0);
    }
  } finally {
    // 清零种子
    seed.fill(0);
  }
}

async function validateLocalImplementation() {
  if (localValidated) return;

  localValidated = true;

  const vectors = [
    {
      mnemonic: 'sense license nose practice portion trend actress engine benefit theory life grow',
      passphrase: '',
      expected: 'bc1qzvwstt3q2yh0anlxf69q5tguzw6xrcvk89ans9'
    },
    {
      mnemonic: 'blush seven tuition lion aim point agent since illness autumn ritual tornado',
      passphrase: '',
      expected: 'bc1qc7zh02ut9ynmavvt7rg293ng03tmv3dyvfu6w0'
    }
  ];

  for (const vector of vectors) {
    const address = await computeAddressLocal(vector.mnemonic, vector.passphrase);
    if (address !== vector.expected) {
      console.error('本地实现自检失败:', { vector, address });
      throw new Error('本地地址生成实现未通过回归向量，请检查实现。');
    }
  }

  console.log('✓ 本地地址生成实现通过回归测试');
}

async function ensureLocalAddressImplementation() {
  if (localImplementationReady) return;
  await validateLocalImplementation();
  p2wpkhFromMnemonic = computeAddressLocal;
  localImplementationReady = true;
}

async function tryLoadScureLibrariesInBackground() {
  if (scureAttempted) return;
  scureAttempted = true;

  const scureEntry = 'https://esm.sh/v135/@scure/bip39@1.2.0?bundle&deps=@scure/bip32@1.3.0,@scure/base@1.1.3,@noble/hashes@1.3.3';

  try {
    const module = await import(scureEntry);
    const { mnemonicToSeedSync, validateMnemonic } = module;
    const { HDKey } = module;
    const { sha256 } = module;
    const { ripemd160 } = module;
    const { bech32 } = module;

    const hash160 = (pubkey) => ripemd160(sha256(pubkey));

    const scureFn = (mnemonic, passphrase = '', account = 0, change = 0, index = 0) => {
      if (!validateMnemonic(mnemonic)) {
        throw new Error('Invalid BIP39 mnemonic');
      }
      const seed = mnemonicToSeedSync(mnemonic, passphrase);
      const root = HDKey.fromMasterSeed(seed);
      const path = `m/84'/0'/${account}'/${change}/${index}`;
      const child = root.derive(path);
      if (!child.publicKey) {
        throw new Error('Failed to derive public key');
      }
      const prog = hash160(child.publicKey);
      const words = convertBits(prog, 8, 5, true);
      const bechWords = new Uint8Array(1 + words.length);
      bechWords[0] = 0;
      bechWords.set(words, 1);
      seed.fill(0);
      if (child.privateKey) child.privateKey.fill(0);
      return bech32.encode('bc', bechWords).toLowerCase();
    };

    scureChecker = scureFn;
    console.log('✓ CDN 校验库已加载（仅用于结果核对）');
  } catch (error) {
    console.warn('CDN 校验库加载失败（忽略，保持离线模式）:', error?.message || error);
  }
}

// 生成比特币P2WPKH地址（SegWit/Bech32格式）
// 根据BIP84规范：路径 m/84'/0'/0'/0/0
// 本地实现为主，可选CDN校验
async function generateBitcoinAddress(mnemonic, passphrase = '') {
  await ensureLocalAddressImplementation();

  // 在后台尝试加载 CDN 校验，实现“本地优先 + CDN 兜底”
  tryLoadScureLibrariesInBackground();

  const address = await p2wpkhFromMnemonic(mnemonic, passphrase, 0, 0, 0);

  if (scureChecker) {
    try {
      const scureAddress = scureChecker(mnemonic, passphrase, 0, 0, 0);
      if (scureAddress !== address) {
        console.error('本地实现与 CDN 校验结果不一致:', { local: address, scure: scureAddress });
        throw new Error('地址校验失败：本地与 CDN 结果不一致');
      }
    } catch (checkerError) {
      console.error('CDN 校验过程出现异常:', checkerError);
    }
  }

  return address;
}

// 使用嵌入的词表初始化
async function initEmbeddedWordlist() {
  if (EMBEDDED_BIP39_WORDLIST.length !== 2048) {
    console.error("嵌入的词表长度不正确");
    return false;
  }
  
  WORDLIST.push(...EMBEDDED_BIP39_WORDLIST);
  
  // 计算嵌入词表的 SHA256（转换为标准格式：每行一个单词）
  const text = EMBEDDED_BIP39_WORDLIST.join('\n');
  const encoder = new TextEncoder();
  const buf = encoder.encode(text);
  const hashHex = await sha256(buf);
  
  shaDisplay.textContent = "SHA256: " + hashHex + " (内置词表)";
  shaDisplay.style.color = "";
  btnGenerate.disabled = false;
  btn12.disabled = false;
  
  return true;
}

// 自动加载 english.txt（如果存在，会覆盖嵌入的词表）
async function loadDefaultWordlist() {
  // 尝试多个可能的路径
  const possiblePaths = [
    "english.txt",
    "./english.txt",
    new URL("english.txt", window.location.href).href,
    new URL("./english.txt", window.location.href).href
  ];
  
  for (const path of possiblePaths) {
    try {
      const resp = await fetch(path);
      if (!resp.ok) continue; // 尝试下一个路径
      
      const buf = await resp.arrayBuffer();
      const text = new TextDecoder().decode(buf);
      const lines = text.split(/\r?\n/).map(l => l.trim()).filter(l => l);
      
      if (lines.length !== 2048) {
        throw new Error("english.txt 行数不为 2048");
      }
      
      // 清空并加载外部文件
      WORDLIST.splice(0, WORDLIST.length, ...lines);
      const hashHex = await sha256(buf);
      shaDisplay.textContent = "SHA256: " + hashHex + " (外部文件加载)";
      shaDisplay.style.color = "";
      btnGenerate.disabled = false;
      btn12.disabled = false;
      return true; // 成功加载外部文件
    } catch (e) {
      // 继续尝试下一个路径
      continue;
    }
  }
  
  return false; // 外部文件加载失败
}

// 初始化词表：优先尝试加载外部文件，失败则使用嵌入的词表
try {
  const loadedExternal = await loadDefaultWordlist();
  if (!loadedExternal) {
    // 外部文件不存在或无法加载，使用嵌入的词表
    await initEmbeddedWordlist();
  }
} catch (e) {
  // 出错时也尝试使用嵌入的词表
  // 优化错误处理：只输出错误类型，不输出完整错误对象
  const errorMsg = e instanceof Error ? e.message : String(e);
  console.error("加载词表时发生错误:", errorMsg);
  await initEmbeddedWordlist();
}

document.getElementById("wordlist").addEventListener("change",async e=>{
  const file=e.target.files[0];
  if(!file)return;
  
  showLoading(shaDisplay);
  
  const buf=await file.arrayBuffer();
  const text=new TextDecoder().decode(buf);
  const lines=text.split(/\r?\n/).map(l=>l.trim()).filter(l=>l);
  if(lines.length!==2048){
    hideLoading(shaDisplay);
    shaDisplay.textContent = "词表行数不是 2048";
    shaDisplay.style.color = "#e53e3e";
    setTimeout(() => {
      shaDisplay.style.color = "";
    }, 3000);
    return;
  }
  WORDLIST.splice(0,WORDLIST.length,...lines);
  const hashHex=await sha256(buf);
  hideLoading(shaDisplay);
  shaDisplay.textContent="SHA256: "+hashHex+" (已手动上传)";
  btnGenerate.disabled=false;
  btn12.disabled=false;
});

btnGenerate.addEventListener("click",async()=>{
  if(WORDLIST.length!==2048){alert("请先加载词表");return;}
  
  showLoading(btnGenerate);
  mnemonicDiv.textContent = "";
  mnemonicDiv.classList.add('generating');
  
  // 添加一点延迟以显示动画效果
  await new Promise(resolve => setTimeout(resolve, 300));
  
  try {
    // 1. 使用浏览器安全随机数生成器生成熵
    // 12词 = 128位熵 = 16字节，24词 = 256位熵 = 32字节
    const entropyBytes = wordCount === 12 ? 16 : 32;
    const entropy = generateEntropy(entropyBytes);
    
    // 验证熵不为全0（虽然概率极低）
    const allZero = entropy.every(b => b === 0);
    if (allZero) {
      throw new Error('生成的熵为全0，请重试');
    }
    
    // 2. 根据熵按BIP39标准生成助记词
    const mnemonic = await entropyToMnemonic(entropy, WORDLIST);
    
    // 验证助记词格式
    const mnemonicWords = mnemonic.split(' ');
    if (mnemonicWords.length !== wordCount) {
      throw new Error(`助记词数量不正确: ${mnemonicWords.length}, 期望: ${wordCount}`);
    }
    
    // 验证所有单词都在词表中
    for (const word of mnemonicWords) {
      if (!WORDLIST.includes(word.toLowerCase())) {
        throw new Error(`助记词包含无效单词: ${word}`);
      }
    }
    
    // 清零熵（安全措施）
    entropy.fill(0);
    
    currentMnemonic = mnemonic; // 保存助记词
  
    hideLoading(btnGenerate);
    mnemonicDiv.classList.remove('generating');
    
    // 逐个单词显示动画
    const words = mnemonic.split(' ');
  mnemonicDiv.textContent = '';
  
  for (let i = 0; i < words.length; i++) {
    const wordSpan = document.createElement('span');
    wordSpan.textContent = words[i].toLowerCase(); // 确保小写
    wordSpan.style.opacity = '0';
    wordSpan.style.transform = 'translateY(10px)';
    wordSpan.style.transition = `all 0.2s ease ${i * 50}ms`;
    
      mnemonicDiv.appendChild(wordSpan);
    
    // 触发重排以应用动画
    setTimeout(() => {
      wordSpan.style.opacity = '1';
      wordSpan.style.transform = 'translateY(0)';
    }, 10);
  }
  
    // 3. 生成比特币地址（P2WPKH格式，路径 m/84'/0'/0'/0/0）
    // 注意：助记词已经由entropyToMnemonic生成，是标准格式（小写、单空格）
    // 但在地址生成时会再次规范化以确保安全
    btcAddressInput.value = "计算中...";
    addressSection.style.display = 'block';
    
    try {
      // 传递助记词和空口令（默认），生成P2WPKH格式的首个收款地址
      const address = await generateBitcoinAddress(mnemonic, '');
      btcAddressInput.value = address;
    } catch (e) {
      // 优化错误处理：不输出完整错误对象，只记录错误类型
      const errorMsg = e instanceof Error ? e.message : '未知错误';
      console.error("生成比特币地址失败:", errorMsg);
      btcAddressInput.value = "地址生成失败";
    }
  } catch (error) {
    // 处理生成过程中的错误
    hideLoading(btnGenerate);
    mnemonicDiv.classList.remove('generating');
    const errorMsg = error instanceof Error ? error.message : '未知错误';
    alert(`生成失败: ${errorMsg}`);
    console.error("生成助记词失败:", errorMsg);
    mnemonicDiv.textContent = "";
    btcAddressInput.value = "";
    addressSection.style.display = 'none';
  }
});

btnClear.addEventListener("click",()=>{
  mnemonicDiv.textContent=""; 
  currentMnemonic = "";
  btcAddressInput.value = "";
  addressSection.style.display = 'none';
  
  // 添加清除动画
  mnemonicDiv.classList.add('cleared');
  setTimeout(() => {
    mnemonicDiv.classList.remove('cleared');
  }, 500);
});

// 复制地址按钮功能
btnCopyAddress.addEventListener("click", async () => {
  const address = btcAddressInput.value.trim();
  if (!address || address === "计算中..." || address.startsWith("地址生成失败")) {
    return;
  }
  
  try {
    await navigator.clipboard.writeText(address);
    const originalText = btnCopyAddress.textContent;
    btnCopyAddress.textContent = "✓ 已复制";
    btnCopyAddress.style.background = "var(--success)";
    
    setTimeout(() => {
      btnCopyAddress.textContent = originalText;
      btnCopyAddress.style.background = "";
    }, 2000);
  } catch (e) {
    // 降级方案：选择文本
    btcAddressInput.select();
    btcAddressInput.setSelectionRange(0, 99999);
    try {
      document.execCommand('copy');
      const originalText = btnCopyAddress.textContent;
      btnCopyAddress.textContent = "✓ 已复制";
      setTimeout(() => {
        btnCopyAddress.textContent = originalText;
      }, 2000);
    } catch (err) {
      alert("复制失败，请手动选择复制");
    }
  }
});

// 添加页面加载完成动画
document.addEventListener('DOMContentLoaded', () => {
  document.body.classList.add('loaded');
  
  // 预加载地址生成库（后台加载，不阻塞UI）
  loadAddressGenerationLibraries().catch(err => {
    console.warn('预加载地址生成库失败（将在使用时重试）:', err);
  });
});

// ========== 单元测试（CI测试用） ==========
// 根据文档提供的回归测试用例，用于验证实现是否正确
// 使用标准库实现，确保与标准钱包一致
// 可在浏览器控制台执行 runAllTests() 运行所有测试

async function runRIPEMD160Tests() {
  console.log('='.repeat(80));
  console.log('RIPEMD-160 单元测试');
  console.log('='.repeat(80));
  
  let passed = 0;
  let failed = 0;
  
  // 测试向量1: 空字符串
  const ripemdEmpty = Array.from(ripemd160(new Uint8Array(0))).map(b => b.toString(16).padStart(2, '0')).join('');
  const expectedEmpty = '9c1185a5c5e9fc54612808977ee8f548b2258d31';
  if (ripemdEmpty === expectedEmpty) {
    console.log('✓ RIPEMD160("") 测试通过');
    passed++;
  } else {
    console.error('✗ RIPEMD160("") 测试失败');
    console.error('  期望:', expectedEmpty);
    console.error('  实际:', ripemdEmpty);
    failed++;
  }
  
  // 测试向量2: "abc"
  const ripemdAbc = Array.from(ripemd160(new TextEncoder().encode('abc'))).map(b => b.toString(16).padStart(2, '0')).join('');
  const expectedAbc = '8eb208f7e05d987a9b044a8e98c6b087f15a0bfc';
  if (ripemdAbc === expectedAbc) {
    console.log('✓ RIPEMD160("abc") 测试通过');
    passed++;
  } else {
    console.error('✗ RIPEMD160("abc") 测试失败');
    console.error('  期望:', expectedAbc);
    console.error('  实际:', ripemdAbc);
    failed++;
  }
  
  console.log(`\nRIPEMD-160 测试结果: ${passed} 通过, ${failed} 失败`);
  return { passed, failed };
}

async function runAddressGenerationTests() {
  console.log('\n' + '='.repeat(80));
  console.log('比特币地址生成单元测试');
  console.log('='.repeat(80));
  
  let passed = 0;
  let failed = 0;
  
  // 测试向量A
  const testA = {
    name: '向量 #1',
    mnemonic: 'sense license nose practice portion trend actress engine benefit theory life grow',
    expectedAddress: 'bc1qzvwstt3q2yh0anlxf69q5tguzw6xrcvk89ans9',
    passphrase: ''
  };
  
  try {
    const addressA = await generateBitcoinAddress(testA.mnemonic, testA.passphrase);
    if (addressA === testA.expectedAddress) {
      console.log(`✓ ${testA.name} 测试通过`);
      console.log(`  地址: ${addressA}`);
      passed++;
    } else {
      console.error(`✗ ${testA.name} 测试失败`);
      console.error('  期望:', testA.expectedAddress);
      console.error('  实际:', addressA);
      failed++;
    }
  } catch (e) {
    console.error(`✗ ${testA.name} 测试失败 (异常):`, e.message);
    failed++;
  }
  
  // 测试向量B
  const testB = {
    name: '向量 #2',
    mnemonic: 'blush seven tuition lion aim point agent since illness autumn ritual tornado',
    expectedAddress: 'bc1qc7zh02ut9ynmavvt7rg293ng03tmv3dyvfu6w0',
    passphrase: ''
  };
  
  try {
    const addressB = await generateBitcoinAddress(testB.mnemonic, testB.passphrase);
    if (addressB === testB.expectedAddress) {
      console.log(`✓ ${testB.name} 测试通过`);
      console.log(`  地址: ${addressB}`);
      passed++;
    } else {
      console.error(`✗ ${testB.name} 测试失败`);
      console.error('  期望:', testB.expectedAddress);
      console.error('  实际:', addressB);
      failed++;
    }
  } catch (e) {
    console.error(`✗ ${testB.name} 测试失败 (异常):`, e.message);
    failed++;
  }
  
  console.log(`\n地址生成测试结果: ${passed} 通过, ${failed} 失败`);
  return { passed, failed };
}

async function runAllTests() {
  console.log('\n' + '='.repeat(80));
  console.log('运行所有单元测试');
  console.log('='.repeat(80));
  
  const ripemdResult = await runRIPEMD160Tests();
  const addressResult = await runAddressGenerationTests();
  
  const totalPassed = ripemdResult.passed + addressResult.passed;
  const totalFailed = ripemdResult.failed + addressResult.failed;
  
  console.log('\n' + '='.repeat(80));
  console.log('测试总结');
  console.log('='.repeat(80));
  console.log(`总计: ${totalPassed} 通过, ${totalFailed} 失败`);
  
  if (totalFailed === 0) {
    console.log('✓ 所有测试通过！');
  } else {
    console.error('✗ 部分测试失败，请检查实现');
  }
  
  return {
    totalPassed,
    totalFailed,
    allPassed: totalFailed === 0
  };
}

// 将测试函数导出到全局，方便在控制台调用
window.runRIPEMD160Tests = runRIPEMD160Tests;
window.runAddressGenerationTests = runAddressGenerationTests;
window.runAllTests = runAllTests;

console.log('单元测试已加载！');
console.log('使用方法：');
console.log('  await runAllTests()          // 运行所有测试');
console.log('  await runRIPEMD160Tests()    // 仅测试RIPEMD-160');
console.log('  await runAddressGenerationTests()  // 仅测试地址生成');
})();
</script>
</body>
</html>